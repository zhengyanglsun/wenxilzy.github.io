<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Linux学习 | Komorebi</title><meta name="keywords" content="Linux"><meta name="author" content="Komorebi,2039222749@qq.com"><meta name="copyright" content="Komorebi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="常用文件管理命令 linux文件系统 根目录：&#x2F; 根目录常见文件夹  bin 常用的可执行文件命令 etc 配置文件 var 日志保存 lib 安装包 头文件 home 所有用户的家目录 proc 进程相关信息  描述路径的方式  绝对路径 从根目录开始描述，开头一定是&#x2F; 相对路径 开头一定不是&#x2F; …上级目录 .当前目录 ~&#x2F; 家目录  文件常用指令  ctrl c：取消命令 并且换行 ctrl">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux学习">
<meta property="og:url" content="https://wenxilzy.github.io/2022/05/06/Linux%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="Komorebi">
<meta property="og:description" content="常用文件管理命令 linux文件系统 根目录：&#x2F; 根目录常见文件夹  bin 常用的可执行文件命令 etc 配置文件 var 日志保存 lib 安装包 头文件 home 所有用户的家目录 proc 进程相关信息  描述路径的方式  绝对路径 从根目录开始描述，开头一定是&#x2F; 相对路径 开头一定不是&#x2F; …上级目录 .当前目录 ~&#x2F; 家目录  文件常用指令  ctrl c：取消命令 并且换行 ctrl">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.acwing.com/media/article/image/2022/05/16/99310_ddc885a5d4-00117.png">
<meta property="article:published_time" content="2022-05-06T12:44:11.000Z">
<meta property="article:modified_time" content="2022-09-05T08:23:47.975Z">
<meta property="article:author" content="Komorebi">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.acwing.com/media/article/image/2022/05/16/99310_ddc885a5d4-00117.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://wenxilzy.github.io/2022/05/06/Linux%E5%AD%A6%E4%B9%A0/"><link rel="preconnect" href="//fastly.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://fastly.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://fastly.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Linux学习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-05 16:23:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/static/css/custom.css"><meta name="generator" content="Hexo 6.1.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.acwing.com/media/article/image/2022/06/14/99310_54e0b37ceb-touxiang2.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.acwing.com/media/article/image/2022/05/16/99310_ddc885a5d4-00117.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Komorebi</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Linux学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-06T12:44:11.000Z" title="发表于 2022-05-06 20:44:11">2022-05-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-05T08:23:47.975Z" title="更新于 2022-09-05 16:23:47">2022-09-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B7%A5%E7%A8%8B%E8%AF%BE/">工程课</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">21.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>85分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Linux学习"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="常用文件管理命令">常用文件管理命令</h2>
<h3 id="linux文件系统">linux文件系统</h3>
<p>根目录：/<br>
根目录常见文件夹</p>
<ol>
<li>bin 常用的可执行文件命令</li>
<li>etc 配置文件</li>
<li>var 日志保存</li>
<li>lib 安装包 头文件</li>
<li>home 所有用户的家目录</li>
<li>proc 进程相关信息</li>
</ol>
<h3 id="描述路径的方式">描述路径的方式</h3>
<ol>
<li>绝对路径 从根目录开始描述，开头一定是/</li>
<li>相对路径 开头一定不是/</li>
<li>…上级目录 .当前目录</li>
<li>~/ 家目录</li>
</ol>
<h3 id="文件常用指令">文件常用指令</h3>
<ol>
<li><code>ctrl c</code>：取消命令 并且换行</li>
<li><code>ctrl u</code>: 清空本行命令</li>
<li><code>tab</code>:可以补全命令和文件名 如果补全不了快速按两下tab键，可以显示备选选项</li>
<li><code>ls</code>：列出当前目录的所有文件
<ol>
<li>蓝色的是文件夹</li>
<li>白色的是普通文件</li>
<li>绿色的是可执行文件</li>
<li><code>ls -a</code>可以展示所有文件，包括隐藏文件</li>
</ol>
</li>
<li><code>pwd</code>：显示当前路径</li>
<li><code>cd XXX</code>:进入<code>XXX</code>目录下<code>cd...</code>:返回上层目录</li>
<li><code>cp XXX YYY</code>:将<code>XXX</code>文件复制成<code>YYY</code> <code>XXX</code>和<code>YYY</code>可以是一个路径，比如<code>../dir_c/a.txt</code>，表示上层目录下的<code>dir_c</code>文件夹下的文件<code>a.txt</code></li>
<li><code>mkdir XXX</code>： 创建目录<code>XXX</code></li>
<li><code>rm XXX</code>: 删除普通文件 <code>rm XXX -r</code>:删除文件夹</li>
<li><code>mv XXX YYY</code>:将<code>XXX</code>文件移动到<code>YYY</code>和<code>cp</code>命令一样，<code>XXX</code>和<code>YYY</code>可以是一个路径， 重命名也是用这个命令</li>
<li><code>touch XXX</code>：创建一个文件</li>
<li><code>cat XXX</code>:展示文件<code>XXX</code>中的内容</li>
<li>复制文本windows/Linux:<code>ctrl + insert</code> Mac下：<code>command + c</code></li>
<li>粘贴文本windows/Linux:<code>shift + insert</code> Mac下：<code>command + v</code></li>
</ol>
<h3 id="AC-Terminaal的lab指南">AC-Terminaal的lab指南</h3>
<ol>
<li><code>homework 1 create</code>可以重新创建所有<code>lesson_1</code>的作业</li>
<li><code>homework 1 create id</code>可以单独创建<code>lesson_1</code>的第<code>id</code>个作业 e.g. <code>homework 1 create 0</code>可以只重新创建<code>lesson_1</code>的第<code>0</code>个作业</li>
<li><code>homework 1 test</code>可以评测<code>lesson_1</code>的所有作业</li>
<li><code>homework 1 show</code>可以显示第<code>1</code>个作业的要求</li>
</ol>
<h3 id="作业">作业</h3>
<ol start="0">
<li>进入homework_0文件夹，分别创建文件夹dir_a, dir_b, dir_c</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_0<br><span class="hljs-built_in">mkdir</span> dir_a dir_b dir_c<br></code></pre></td></tr></table></figure>
<ol>
<li>进入homework_1文件夹，将a.txt, b.txt, c.txt 分别复制成: a.txt.bak, b.txt.bak, c.txt.bak</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_1<br><span class="hljs-built_in">cp</span> a.txt a.txt.bak<br><span class="hljs-built_in">cp</span> b.txt b.txt.bak<br><span class="hljs-built_in">cp</span> c.txt c.txt.bak<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>进入入homework_2文件夹，将a.txt, b.txt, c.txt 分别重命名为: a_new.txt, b_new.txt, c_new.txt</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_2<br><span class="hljs-built_in">mv</span> a.txt a_new.txt<br><span class="hljs-built_in">mv</span> b.txt b_new.txt<br><span class="hljs-built_in">mv</span> c.txt c_new.txt<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>进入homework_3文件夹，将dir_a文件夹下的a.txt, b.txt, c.txt分别移动到文件夹dir_b下</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_3<br><span class="hljs-built_in">mv</span> dir_a/* dir_b/<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>进入homework_4文件夹，将普通文件a.txt, b.txt, c.txt删除</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_4<br><span class="hljs-built_in">rm</span> a.txt b.txt c.txt<br></code></pre></td></tr></table></figure>
<ol start="5">
<li>进入homework_5文件夹，将文件夹dir_a, dir_b, dir_c删除</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_5<br><span class="hljs-built_in">rm</span> * -r<br></code></pre></td></tr></table></figure>
<ol start="6">
<li>进入homework_6文件夹，查看task.txt的内容，并按其指示进行操作</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_6<br><span class="hljs-built_in">cat</span> task.txt<br><span class="hljs-built_in">mkdir</span> dir_a<br><span class="hljs-built_in">mv</span> task.txt dir_a/done.txt<br></code></pre></td></tr></table></figure>
<ol start="7">
<li>进入homework_7文件夹，创建文件夹dir_0, dir_1, dir_2， 1. 将a.txt, b.txt, c.txt复制到dir_0下，重命名为a0.txt, b0.txt, c0.txt; 2. 将a.txt, b.txt, c.txt复制到dir_1下，重命名为a1.txt, b1.txt, c1.txt; 3. 将a.txt, b.txt, c.txt复制到dir_2下，重命名为a2.txt, b2.txt, c2.txt;</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_7<br><span class="hljs-built_in">mkdir</span> dir_0 dir_1 dir_2<br><span class="hljs-built_in">cp</span> a.txt dir_0/a0.txt<br><span class="hljs-built_in">cp</span> a.txt dir_1/a1.txt<br><span class="hljs-built_in">cp</span> a.txt dir_2/a2.txt<br><span class="hljs-built_in">cp</span> b.txt dir_0/b0.txt<br><span class="hljs-built_in">cp</span> b.txt dir_1/b1.txt<br><span class="hljs-built_in">cp</span> b.txt dir_2/b2.txt<br><span class="hljs-built_in">cp</span> c.txt dir_0/c0.txt<br><span class="hljs-built_in">cp</span> c.txt dir_1/c1.txt<br><span class="hljs-built_in">cp</span> c.txt dir_2/c2.txt<br></code></pre></td></tr></table></figure>
<ol start="8">
<li>进入homework_8文件夹，分别在dir_a, dir_b, dir_c文件夹下查看task.txt的内容，并分别按照指示进行操作</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_8<br><span class="hljs-built_in">cd</span> dir_a<br><span class="hljs-built_in">cat</span> task.txt<br><span class="hljs-built_in">rm</span> a.txt<br><span class="hljs-built_in">cd</span> ../dir_b/<br><span class="hljs-built_in">cat</span> task.txt<br><span class="hljs-built_in">mv</span> b.txt b_new.txt<br><span class="hljs-built_in">cd</span> ../dir_c/<br><span class="hljs-built_in">cat</span> task.txt<br><span class="hljs-built_in">cp</span> c.txt c.txt.bak<br></code></pre></td></tr></table></figure>
<ol start="9">
<li>进入homework_9文件夹，将其中所有txt类型的文件删除</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_9<br><span class="hljs-built_in">rm</span> *.txt<br></code></pre></td></tr></table></figure>
<h2 id="tmux和vim">tmux和vim</h2>
<h3 id="tmux教程">tmux教程</h3>
<p>功能：</p>
<ol>
<li>分屏</li>
<li>允许断开Terminal连接后，继续运行进程<br>
结构：<br>
一个tmux可以包含多个session，一个session可以包含多个window，一个window可以包含多个pane<br>
实例：</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs SH">tmux:  <br>    session 0:<br>    |   window 0:<br>    |   |   pane 0<br>    |   |   pane 1<br>    |   |   pane2<br>    |   |   ...<br>    |   window 1<br>    |   window 2<br>    |   ...<br>    session 1<br>    session 2<br>    ...<br></code></pre></td></tr></table></figure>
<p>操作：</p>
<blockquote>
<p>AC-Terminal下前缀键被修改为<kbd>Ctrl + a</kbd>, 一般默认情况为<kbd>Ctrl + b</kbd></p>
</blockquote>
<ol>
<li>tmux:新建一个session，其中包含window，window中包含一个pane，pane里打开一个shell对话框</li>
<li>按下<kbd>Ctrl + a</kbd>后手指松开，然后按<kbd>%</kbd>:将当前pane左右平分成两个pane.</li>
<li>按下<kbd>Ctrl + a</kbd>后手指松开，然后按<kbd>&quot;</kbd>:将当前pane上下平分成两个pane.</li>
<li><kbd>Ctrl + d</kbd>：关闭当前pane；当前window的所有pane均已关闭，则自动关闭window；如果当前session的所有window均已经关闭，则自动关闭session。</li>
<li>鼠标点击可以选pane</li>
<li>按下<kbd>Ctrl+a</kbd>后手指松开，然后按<strong>方向键</strong>：先择相邻的pane</li>
<li>鼠标拖动pane之间的分割线，可以调整分割线的位置</li>
<li>按住<kbd>Ctrl+a</kbd>的同时按<strong>方向键</strong>，可以调整pane之间分割线的位置。</li>
<li>按下<kbd>Ctrl+a</kbd>后手指松开，然后按<kbd>z</kbd>：将当前pane全屏/取消全屏</li>
<li>按下<kbd>Ctrl+a</kbd>后手指松开，然后按d：挂起当前<strong>session</strong></li>
<li><kbd>tmux a</kbd>：打开之前挂起的session。</li>
<li>按下<kbd>Ctrl + a</kbd>后手指松开，然后按s，选择其他session。1.方向键——<code>上</code>：选择上一项session/window/pane 2.方向键——下：选择下一项session/window/pane 3. 方向键——<code>右</code>：展开当前项session/window 4.方向键——<code>左</code>：闭合当前项session/window</li>
<li>按下<kbd>Ctrl + a</kbd>后手指松开，然后按<code>c</code>:在当前session中创建一个新的window。</li>
<li>按下<kbd>Ctrl + a</kbd>后手指松开，然后按<code>w</code>：选择其他window，操作方法与(12)完全相同。</li>
<li>按下<kbd>Ctrl + a</kbd>后手指松开，然后按<code>PageUp</code>：翻阅当前pane的内容</li>
<li>鼠标滚轮：翻阅当前pane内的内容</li>
<li>在tmux中选中文本时，需要按住<code>shift</code>键。（仅支持window和linux，不支持Mac，不过该操作不是必须的，因此影响不大）</li>
<li>tmux中复制/粘贴文本的通用方式：
<ol>
<li>按下<kbd>Ctrl + a</kbd>后手指松开，然后按<code>[</code></li>
<li>用鼠标选中文本，被选中的文本会被自动复制到tmux的剪切板</li>
<li>按下<code>Ctrl + a</code>后松开手指，然后按<code>]</code>，会将剪切板中的内容粘贴到光标处</li>
</ol>
</li>
</ol>
<h3 id="vim教程">vim教程</h3>
<p><strong>功能</strong>：1.命令行模式下的文本编辑器。2.根据文件拓展名自动判别编程语言。支持代码缩进，代码高亮等功能，3.使用方式：<code>vim filename</code>1.如果已有文件，则打开它2.如果没有文件，则打开一个新的文件，并命名为filename<br>
<strong>模式</strong>1.一般命令模式 默认模式。命令输入方式：类似于打游戏放技能，按不同字符，即可出现不同的操作，可以复制，粘贴，删除文本等。2.编辑模式在一般命令模式里按下i，会进入编辑模式。按下<code>ESC</code>会退出<code>编辑模式</code>，返回<code>一般命令模式</code>3.<strong>命令行模式</strong>在<strong>一般命令模式</strong>里按下<code>:/?</code>三个字母中的任意一个，会进入<strong>命令行模式</strong>。命令行在最下面。可以查找，替换，保存，退出，配置编辑器等。<br>
操作：</p>
<ol>
<li>一般模式切换到编辑模式（常用）
<ol>
<li><code>i</code>:从光标所处位置<strong>直接</strong>开始</li>
<li><code>a</code>:从光标所处位置<code>下一个字符</code>开始</li>
<li><code>o</code>：从光标所处位置的<code>下一行</code>开始</li>
<li><code>r</code>:取代当前光标处的字符，然后开始</li>
<li><code>[ESC]</code>：退出编辑模式，回到一般模式</li>
</ol>
</li>
<li>光标移动操作
<ol>
<li><code>h</code>或<code>左箭头键</code>：光标向<code>左</code>移动 <code>一个字符</code></li>
<li><code>j</code> 或 <code>向下箭头</code>： 光标向<code>下</code>移动<code>一个字符</code></li>
<li><code>k</code>或<code>向上箭头</code>：光标向<code>上</code>移动<code>一个字符</code></li>
<li><code>l</code>或<code>向右箭头</code>:光标向<strong>右</strong>移动<code>一个字符</code></li>
<li>n<Space>：n为数字，光标向右移动这一行的n个字符</li>
<li>n<Enter>:n为数字，光标<strong>向下移动n行</strong></li>
<li><code>0</code>或<code>功能键[Home]</code>：光标移动到<strong>本行开头</strong></li>
<li><code>$</code>或<code>功能键[End]</code>:光标移动到<strong>本行末尾</strong></li>
<li><code>G</code>：光标移动到<strong>最后一行</strong></li>
<li><code>:n</code>或<code>nG</code>:<strong>n</strong>为数字，光标移动到<strong>第n行</strong></li>
<li><code>gg</code>:光标移动到<strong>第一行</strong>，相当于<code>1G</code></li>
</ol>
</li>
<li>查找，替换操作
<ol>
<li><code>/word</code>：向<strong>光标之下</strong> <strong>寻找</strong>第一个值为<code>word</code>的字符串</li>
<li><code>?word</code>：向<strong>光标之上</strong> <strong>寻找</strong>第一个值为<code>word</code>的字符串</li>
<li><code>n</code>:<strong>重复</strong>前一个<strong>查找操作</strong></li>
<li><code>N</code>:反向<strong>重复</strong>前一个<strong>查找操作</strong></li>
<li><code>:n1,n2s/word1/word2/g</code>：<code>n1</code>与<code>n2</code>为数字，在第<code>n1</code>行与<code>n2</code>行之间寻找<code>word1</code>这个字符串，并将改字符串<strong>替换</strong>为<code>word2</code></li>
<li><code>:1,$s/word1/word2/g</code>：将全文的<code>word1</code>替换为<code>word2</code></li>
<li><code>:1,$s/word1/word2/gc</code>:将全文的<code>word1</code>替换为<code>word2</code>，且在替换前<strong>要求用户确认</strong></li>
</ol>
</li>
<li>文本操作（可搭配<code>数字+&lt;enter&gt;/&lt;space&gt;、0、G、$</code>等使用，达到预期组合效果）
<ol>
<li><code>v</code>：选中文本</li>
<li><code>d</code>:<strong>删除选中的文本</strong></li>
<li><code>dd</code>:删除当前行</li>
<li><code>y</code>:复制选中的文本</li>
<li><code>yy</code>:复制当前行</li>
<li><code>p</code>:将复制的数据在光标的下一行/下一位置 <strong>粘贴</strong></li>
<li><code>u</code>：撤销</li>
<li><kbd>Ctrl + r</kbd>取消撤销</li>
<li><kbd>shift+&gt;</kbd>：将选中的文本整体 <strong>向右缩进一次</strong></li>
<li><kbd>shift+&lt;</kbd>： 将选中的文本整体 <strong>向左缩进一次</strong></li>
</ol>
</li>
<li>命令行操作
<ol>
<li><code>:w</code>：保存</li>
<li><code>:w!</code>：强制保存</li>
<li><code>:q</code>:退出</li>
<li><code>:q!</code>:强制退出</li>
<li><code>:wq</code>：保存并退出</li>
<li><code>:set paste</code>：设置成粘贴模式，取消代码的自动缩进</li>
<li><code>:set nopaste</code>:取消粘贴模式，开启代码自动缩进</li>
<li><code>:set nu</code>:显示行号</li>
<li><code>:set nonu</code>:隐藏行号</li>
<li><code>:noh</code> 关闭查找关键词高亮</li>
</ol>
</li>
<li><code>gg=G</code>将全文代码格式化</li>
<li><kbd>Ctrl + q</kbd>：当vim卡死时，可以<strong>取消当前正在执行的命令</strong></li>
<li>异常处理
<ol>
<li>每次用vim编辑文件，会自动创建一个filename.swp的临时文件</li>
<li>如果打开某个文件时，该文件的swp文件已存在，则会报错。此时解决办法有两种：</li>
</ol>
</li>
<li>找到正在打开该文件的程序，并退出</li>
<li>直接删掉该swp文件即可</li>
</ol>
<h3 id="作业-2">作业</h3>
<ol start="0">
<li>进入homework_0文件夹，创建文件names.txt，并顺次将下列姓名写入该文件，每个名字占一行。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_0<br>vim names.txt<br>输入 i 进入编辑模式<br>依次输入各个单词<br>按ESC返回一般命令模式  <br>按 :wq 保存并退出<br></code></pre></td></tr></table></figure>
<ol>
<li>进入homework_1文件夹，打开problem.txt，并依次删除下列字符：<br>
最后一行第101个字符<br>
第3行第8个字符<br>
第1行第30个字符<br>
第16行第55个字符<br>
第9行第80个字符<br>
最后保存文件并退出</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_0<br>vim names.txt<br>输入 i 进入编辑模式<br>依次输入各个单词<br>按ESC返回一般命令模式  <br>按 :wq 保存并退出<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>进入homework_2文件夹，打开problem.txt，并依次执行如下操作： 1. 在第1个&quot;two&quot;的后面添加&quot;abc&quot; 2. 在第2个&quot;two&quot;的前面添加&quot;def&quot; 3. 将第3个&quot;two&quot;后面的连续12个字符删掉 4. 将第4个&quot;two&quot;所在的行删掉<br>
最后保存文件并退出。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_1<br>vim problem.txt<br>[1] 最后一行第101个字符：G101&lt;Space&gt;i&lt;Backspace&gt;ESC<br>[2] 第3行第8个字符：3G8&lt;Space&gt;i&lt;Backspace&gt;ESC<br>[3] 第1行第30个字符：gg30&lt;Space&gt;i&lt;Backspace&gt;ESC<br>[4] 第16行第55个字符：:16&lt;Enter&gt;55&lt;Space&gt;i&lt;Backspace&gt;ESC<br>[5] 第9行第80个字符：9G80&lt;Space&gt;i&lt;Backspace&gt;ESC<br>:wq&lt;Enter&gt;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>进入homework_3文件夹，打开problem.txt，并依次执行如下操作：<br>
将第5行至第15行中所有 of 替换成 OF<br>
将全文中所有的 the 替换成 THE<br>
将第偶数个 is替换成 IS，第奇数个 is不变(下标从1开始)</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_3<br>vim problem.txt  <br>[1] 将第5行至第15行中所有of替换成OF  :5,15s/of/OF/g<br>[2] 将全文中所有的the替换成THE  :1,<span class="hljs-variable">$s</span>/the/THE/g<br>[3] 将第偶数个is替换成IS，第奇数个is不变(下标从1开始)  :1,<span class="hljs-variable">$s</span>/is/IS/gc  然后ny交替按即可<br>:wq&lt;Enter&gt;<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>进入homework_4文件夹，打开problem.txt，并依次执行如下操作：<br>
删除第11行<br>
将所删除的行粘贴到文件最后一行的下一行</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_4<br>vim problem.txt<br>[1] 删除第11行  11Gdd<br>[2] 将所删除的行粘贴到文件最后一行的下一行  Gp<br>[3] 复制第5行  5Gyy<br>[4] 将所复制的行粘贴到文件当前最后一行的下行  Gp<br>:wq&lt;Enter&gt;<br></code></pre></td></tr></table></figure>
<ol start="5">
<li>进入homework_5文件夹，打开problem.txt，并依次执行如下操作：<br>
删除第11行第15个字符（包含该字符）至第13行第5个字符（包含该字符）<br>
将所删除的内容粘贴到文件末尾（注意不要另起一行）<br>
复制第5行第88个字符（包含该字符）至第7行第6个字符（包含该字符）<br>
将所复制的内容粘贴到当前文件末尾（注意不要另起一行）</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_5<br>vim problem.txt<br>[1] 删除第11行第15个字符（包含该字符）至第13行第5个字符（包含该字符）  11G14&lt;Space&gt;v13G5&lt;Space&gt;d<br>[2] 将所删除的内容粘贴到文件末尾（注意不要另起一行）  G<span class="hljs-variable">$p</span><br>[3] 复制第5行第88个个字符（包含该字符）至第7行第6个字符（包含该字符）  5G87&lt;Space&gt;v7G6&lt;Space&gt;y<br>[4] 将所复制的内容粘贴到当前文件末尾（注意不要另起一行） G<span class="hljs-variable">$p</span><br>:wq&lt;Enter&gt;<br></code></pre></td></tr></table></figure>
<ol start="6">
<li>进入homework_6文件夹，并依次执行如下操作：<br>
清空source0.cpp<br>
将source1.cpp中的第1-3行和第12-24行复制到source0.cpp中</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_6<br>vim source0.cpp<br><span class="hljs-built_in">cd</span> homework_6<br>vim source0.cpp<br><br>ggdG  <span class="hljs-comment"># 删掉全文</span><br><br>Ctrl + a + <span class="hljs-string">&quot;   # 在tmux中打开一个新的pane</span><br><span class="hljs-string">vim source1.cpp</span><br><span class="hljs-string">:set nonu  删掉行号</span><br><span class="hljs-string">使用tmux的复制模式(Ctrl-a, [)复制source1.cpp的第1-3行</span><br><span class="hljs-string">选择source0.cpp所在的pane</span><br><span class="hljs-string">:set paste 进入粘贴模式</span><br><span class="hljs-string">i进入编辑模式</span><br><span class="hljs-string">使用tmux的粘贴模式(Ctrl-a, ])粘贴内容。</span><br><span class="hljs-string"></span><br><span class="hljs-string">同理操作source1.cpp的第12-24行</span><br><span class="hljs-string"></span><br><span class="hljs-string">保存source0.cpp  :wq</span><br><span class="hljs-string">退出source1.cpp  :q</span><br></code></pre></td></tr></table></figure>
<ol start="7">
<li>进入homework_7文件夹，格式化source.cpp</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_7<br>vim source.cpp<br>gg=G  全文格式化<br><br>:wq&lt;Enter&gt;<br></code></pre></td></tr></table></figure>
<ol start="8">
<li>进入homework_8文件夹，打开source.cpp，并依次执行如下操作：<br>
将第15-21行向右缩进2次<br>
将第22-23行向左缩进1次</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework_8<br>vim source.cpp<br>15Gv21G <span class="hljs-comment"># 选中15-21行</span><br>&gt; <span class="hljs-comment"># 向右缩进一次</span><br><span class="hljs-comment"># 同理再缩进一次</span><br><br>22Gv23G <span class="hljs-comment"># 选中22-23行</span><br>&lt; <span class="hljs-comment"># 向左缩进一次</span><br><br>:wq&lt;Enter&gt;<br></code></pre></td></tr></table></figure>
<ol start="9">
<li>进入homework_9文件夹，打开链接：<a target="_blank" rel="noopener" href="https://www.acwing.com/activity/content/code/content/1694465/">https://www.acwing.com/activity/content/code/content/1694465/</a> 新建文件source.cpp，将链接中的代码抄进source.cpp文件中。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework/lesson_2/homework_9<br>vim source.cpp<br>i<br><span class="hljs-comment">#include &lt;iostream&gt;</span><br><br>using namespace std;<br><br>int <span class="hljs-function"><span class="hljs-title">main</span></span>()<br>&#123;<br>    int a, b;<br>    cin &gt;&gt; a &gt;&gt; b;<br>    cout &lt;&lt; <span class="hljs-string">a + b &lt;&lt; endl;</span><br><span class="hljs-string">    return 0;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">:wq&lt;Enter&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="shell语法">shell语法</h2>
<h3 id="概论">概论</h3>
<p>Shell是一个用c语言编写的程序，他是用户使用Linux的桥梁。<br>
Shell既是一种命令语言，又是一种程序设计语言。<br>
Shell是指一种应用程序，这个应用程序提供了一个界面，用户通过这个界面访问操作系统内核的服务。<br>
Ken Thompson 的sh 是第一种Unix Shell，Window Explorer是一个典型的图形界面Shell。<br>
<strong>脚本示例</strong><br>
<a target="_blank" rel="noopener" href="http://xn--test-k84fui098hxhl.sh">新建一个test.sh</a>，内容如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello World!&quot;</span><br></code></pre></td></tr></table></figure>
<p><strong>运行方式</strong><br>
作为可执行文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">chmod</span> +x test.h <span class="hljs-comment"># 使脚本具有可执行权限  </span><br>acs@9e0ebfcd82d7:~$ ./test.sh <span class="hljs-comment"># 当前路径执行</span><br>Hello World! <span class="hljs-comment"># 脚本输出</span><br></code></pre></td></tr></table></figure>
<p>用解释器执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH">acs@9e0ebfcd82d7:~$ bash test.sh<br>Hello World!  <span class="hljs-comment"># 脚本输出</span><br></code></pre></td></tr></table></figure>
<h3 id="注释">注释</h3>
<p><strong>单行注释</strong><br>
每行中<code>#</code>之后的内容均是注释。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-comment"># 这是一行注释</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Hello World&#x27;</span> <span class="hljs-comment"># 这也是一行注释</span><br></code></pre></td></tr></table></figure>
<p><strong>多行注释</strong><br>
格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SH">:&lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">第一行注释</span><br><span class="hljs-string">第二行注释</span><br><span class="hljs-string">第三行注释</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>
<p>其中EOF可以换成其他任意字符串，例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs SH">:&lt;&lt;<span class="hljs-string">abc</span><br><span class="hljs-string">第一行注释</span><br><span class="hljs-string">第二行注释</span><br><span class="hljs-string">第三行注释</span><br><span class="hljs-string">abc</span><br><br>:&lt;&lt;!<br>第一行注释<br>第二行注释<br>第三行注释<br>!<br></code></pre></td></tr></table></figure>
<h3 id="变量">变量</h3>
<p><strong>定义变量</strong><br>
定义变量，不需要加$符号，例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">name1=<span class="hljs-string">&#x27;yxc&#x27;</span> <span class="hljs-comment"># 单引号定义字符串</span><br>name2=<span class="hljs-string">&#x27;yxc&#x27;</span> <span class="hljs-comment"># 双引号定义字符串</span><br>name3=yxc <span class="hljs-comment"># 也可以不加引号，同样表示字符串</span><br></code></pre></td></tr></table></figure>
<p><strong>使用变量</strong><br>
使用变量，需要加上<code>$</code>符号，或者<code>$&#123;&#125;</code>符号。花括号是可选的，主要是为了帮助解释器识别变量边界。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH">name=yxc<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$name</span> <span class="hljs-comment"># 输出yxc</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;name&#125;</span> <span class="hljs-comment"># 输出yxc</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;name&#125;</span>acwing <span class="hljs-comment"># 输出yxcacwing</span><br></code></pre></td></tr></table></figure>
<p><strong>只读变量</strong><br>
使用<code>readonly</code>或者<code>declare</code>可以将变量变为只读</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SH">name=yxc<br><span class="hljs-built_in">readonly</span> name<br><span class="hljs-built_in">declare</span> -r name <span class="hljs-comment"># 两种写法均可  </span><br><br>name=abc <span class="hljs-comment"># 会报错，因为此时name为只读</span><br></code></pre></td></tr></table></figure>
<p><strong>删除变量</strong><br>
<code>unset</code>可以删除变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">name=yxc<br><span class="hljs-built_in">unset</span> name <br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$name</span> <span class="hljs-comment"># 输出空行</span><br></code></pre></td></tr></table></figure>
<p><strong>变量类型</strong></p>
<ol>
<li>自定义变量（局部变量）子进程不能访问的变量</li>
<li>环境变量（全局变量）子进程可以访问的变量</li>
</ol>
<p>自定义变量改为环境变量：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">acs@9e0ebfcd82d7:~$ name = yxc <span class="hljs-comment"># 定义变量</span><br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">export</span> name <span class="hljs-comment"># 第一种方法</span><br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">declare</span> -x name <span class="hljs-comment"># 第二种方法</span><br></code></pre></td></tr></table></figure>
<p>环境变量改为自定义变量：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH">acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">export</span> name = yxc  <span class="hljs-comment"># 定义环境变量</span><br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">declare</span> +x  name   <span class="hljs-comment"># 改为自定义变量</span><br></code></pre></td></tr></table></figure>
<p><strong>字符串</strong><br>
字符串可以用单引号，也可以用双引号，也可以不用引号。<br>
单引号和双引号的区别：</p>
<ol>
<li>单引号中的内容会原样输出，不会执行，不会取变量</li>
<li>双引号中的内容可以执行，可以取变量</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">name = yxc <span class="hljs-comment"># 不用引号</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;hello, $name \&quot;hh\&quot;&#x27;</span> <span class="hljs-comment"># 单引号字符串，输出hello,$name \&quot;hh\&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello, <span class="hljs-variable">$name</span> \&quot;hh\&quot;&quot;</span> <span class="hljs-comment"># 双引号字符串，输出hello,yxc &quot;hh&quot;</span><br></code></pre></td></tr></table></figure>
<p><strong>获取字串长度</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH">name = yxc<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;#name&#125;</span> <span class="hljs-comment"># 输出3</span><br></code></pre></td></tr></table></figure>
<p><strong>提取字串</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH">name=<span class="hljs-string">&quot;hello, yxc&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;name:0:5&#125;</span> <span class="hljs-comment"># 提取从0开始的5个字符</span><br></code></pre></td></tr></table></figure>
<h3 id="默认变量">默认变量</h3>
<p><strong>文本参数变量</strong><br>
在执行shell脚本时，可以向脚本传递参数。<br>
<code>$1</code>是第一个参数，<code>$2</code>是第二个参数，以此类推。特殊的，<code>$0</code>是文件名（包括路径）。例如：<br>
创建文件<code>test.sh</code>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件名：&quot;</span> <span class="hljs-variable">$0</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第一个参数：&quot;</span><span class="hljs-variable">$1</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第二个参数：&quot;</span><span class="hljs-variable">$2</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第三个参数:&quot;</span> <span class="hljs-variable">$3</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;第四个参数: &quot;</span> <span class="hljs-variable">$4</span><br></code></pre></td></tr></table></figure>
<p>然后执行该脚本：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs SH">acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">chmod</span> +x test.sh <br>acs@9e0ebfcd82d7:~$ ./test.sh 1 2 3 4<br>文件名: ./test.sh <br>第一个参数: 1<br>第二个参数: 2 <br>第三个参数: 3 <br>第四个参数: 4 <br>其他参数相关变量<br></code></pre></td></tr></table></figure>
<p><strong>其他参数相关变量</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>$#</code></td>
<td style="text-align:center">代表文件传入参数的个数，如上例中值为4</td>
</tr>
<tr>
<td style="text-align:center"><code>$*</code></td>
<td style="text-align:center">由所有参数构成的用空格隔开的字符串，等价上例中的<code>&quot;$1 $2 $3 $4&quot;</code></td>
</tr>
<tr>
<td style="text-align:center"><code>$@</code></td>
<td style="text-align:center">每个参数分别用双括号括起来的字符串，等价于上例中<code>&quot;$1&quot; &quot;$2&quot; &quot;$3&quot; &quot;$4&quot;</code></td>
</tr>
<tr>
<td style="text-align:center"><code>$$</code></td>
<td style="text-align:center">脚本当前运行的进程ID</td>
</tr>
<tr>
<td style="text-align:center"><code>$?</code></td>
<td style="text-align:center">上一条命令的退出状态（exit code),0表示正常退出，其他值表示错误</td>
</tr>
<tr>
<td style="text-align:center"><code>$(command)</code></td>
<td style="text-align:center">返回<code>command</code>这条命令的stdout（可嵌套）</td>
</tr>
<tr>
<td style="text-align:center"><code>command</code></td>
<td style="text-align:center">返回<code>command</code>这条命令的stdout(不可嵌套)</td>
</tr>
</tbody>
</table>
<h3 id="expr命令">expr命令</h3>
<p><code>expr</code>命令用于求表达式的值，格式为：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">expr</span> 表达式<br></code></pre></td></tr></table></figure>
<p><strong>表达式说明:</strong></p>
<ul>
<li>空格隔开每一项</li>
<li>用反斜杠放到shell特定的字符前面（发现表达式运行错误时，可以试试转义）</li>
<li>对包含空格和其他特殊符号的字符串要用引号括起来</li>
<li>expr会在<code>stdout</code>中输出结果。如果为逻辑关系表达式，则结果为真，<code>stdout</code>为<code>1</code>，否则为<code>0</code>.</li>
<li>expr的<code>exit code</code>: 如果为逻辑关系表达式，则结果为真，<code>exit code</code>为<code>0</code>,否则为<code>1</code>.</li>
</ul>
<p><strong>字符串表达式</strong></p>
<ul>
<li><code>length STRING</code>: 返回STRING的长度</li>
<li><code>index STRING CHARSET</code>:<code>CHARSET</code>中任意单个字符在<code>STRING</code>中最前面的字符位置，下标从<code>1</code>开始。如果在<code>STRING</code>中完全不存在<code>CHARSET</code>中的字符，则返回<code>0</code></li>
<li><code>substr STRING POSITION LENGTH</code>:返回<code>STRING</code>字符串中从<code>POSITION</code>开始，长度最大为<code>LENGTH</code>的子串。如果<code>POSITION</code>或<code>LENGTH</code>为负数,<code>0</code>为非数值，则返回空字符串。<br>
示例：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH">str = <span class="hljs-string">&quot;Hello World!&quot;</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> length <span class="hljs-string">&quot;<span class="hljs-variable">$str</span>&quot;</span>` <span class="hljs-comment"># ``不是单引号，表示执行命令，输出出12</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> index <span class="hljs-string">&quot;<span class="hljs-variable">$str</span>&quot;</span> aWd` <span class="hljs-comment"># 输出7，下标从1开始</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> substr <span class="hljs-string">&quot;<span class="hljs-variable">$str</span>&quot;</span> 2 3` <span class="hljs-comment"># 输出 ell</span><br></code></pre></td></tr></table></figure>
<p><strong>整数表达式</strong></p>
<ul>
<li><code>expr</code>支持普通的算数操作，算术表达式优先级低于字符串表达式，高于逻辑表达式。</li>
<li><code>+ -</code> 加减运算。两端参数会转换为整数，如果转换失败组会报错</li>
<li><code>()</code>可以该表优先级，但是需要反斜杠转义<br>
<strong>实例：</strong></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs SH">a=3<br>b=4<br><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> + <span class="hljs-variable">$b</span>` <span class="hljs-comment"># 输出7</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> - <span class="hljs-variable">$b</span>` <span class="hljs-comment"># 输出-1</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> \* <span class="hljs-variable">$b</span>` <span class="hljs-comment"># 输出12 *需要转义</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> / <span class="hljs-variable">$b</span>` <span class="hljs-comment"># 输出0，整除</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> % <span class="hljs-variable">$b</span>` <span class="hljs-comment"># 输出3 </span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> \( <span class="hljs-variable">$a</span> + 1 \) \* \( <span class="hljs-variable">$b</span> + 1 \)` <span class="hljs-comment"># 输出20，值为(a + 1) * (b + 1)</span><br></code></pre></td></tr></table></figure>
<p><strong>逻辑表达式</strong></p>
<ul>
<li><code>|</code>如果第一个参数非空且非零，则返回第一个参数的值，否则返回第二个参数的值，但要求第二个参数的值也是非空或非0，否则返回0，如果第一个参数是非空或非0时，不会计算第二个参数。</li>
<li><code>&amp;</code>如果两个参数都非空且非零，则返回第一个参数，否则返回0.如果第一个参为0或为空，则不会计算第二个参数。</li>
<li>$&lt; \leq = == \ne \geq &gt;$ 比较两端的参数，如果为true，则返回1，否则返回0，“==”是“=”的同义词。“expr”首先尝试将两端的参数转换为整数，并作算术比较，如果转换失败，则按字符集排序做字符比较。</li>
<li><code>()</code>可以表该优先级，但是需要反斜杠转义<br>
示例：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs SH">a = 3<br>b = 4<br><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> &gt; <span class="hljs-variable">$b</span>` <span class="hljs-comment"># 输出0，&gt;需要转义</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> <span class="hljs-string">&#x27;&lt;&#x27;</span> <span class="hljs-variable">$b</span>` <span class="hljs-comment"># 输出1，也可以将特殊字符用引号引起来</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> <span class="hljs-string">&#x27;&gt;=&#x27;</span> <span class="hljs-variable">$b</span>`  <span class="hljs-comment"># 输出0</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> \&lt;\= <span class="hljs-variable">$b</span>` <span class="hljs-comment"># 输出1</span><br><br>c = 0<br>d = 5<br><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$c</span> \&amp; <span class="hljs-variable">$d</span>` <span class="hljs-comment"># 输出0</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> \&amp; <span class="hljs-variable">$b</span>` <span class="hljs-comment"># 输出3</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$c</span> \| <span class="hljs-variable">$d</span>` <span class="hljs-comment"># 输出5</span><br><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$a</span> \| <span class="hljs-variable">$b</span>` <span class="hljs-comment"># 输出3</span><br></code></pre></td></tr></table></figure>
<h3 id="read命令">read命令</h3>
<p><code>read</code>命令用于从标准输入中读取单行数据。当读到文件结束符，<code>exit code</code>为<code>1</code>,否则为<code>0</code>.<br>
参数说明</p>
<ul>
<li><code>-p</code>:后面可以接提示信息</li>
<li><code>-t</code>:后面跟秒数，定义输入字符的等待时间，超过等待时间后会自动忽略此命令<br>
实例：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs SH">acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">read</span> name <span class="hljs-comment"># 读入name的值</span><br>acwing yxc <span class="hljs-comment"># 标准输入</span><br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$name</span> <span class="hljs-comment"># 输出name的值</span><br>acwing yxc <span class="hljs-comment"># 标准输出</span><br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;Please input your name：&quot;</span> -t 30 name<br><span class="hljs-comment"># 读入name的值，等待时间为30秒</span><br>Please input your name:acwing yxc <span class="hljs-comment"># 标准输入</span><br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$name</span> <span class="hljs-comment"># 输出name的值</span><br>acwing yxc <span class="hljs-comment"># 标准输出</span><br></code></pre></td></tr></table></figure>
<h3 id="echo命令">echo命令</h3>
<p><code>echo</code>用于输出字符串<br>
命令格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">echo</span> STRING<br></code></pre></td></tr></table></figure>
<p><strong>显示普通字符串</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello AC Terminal&quot;</span><br><span class="hljs-built_in">echo</span> Hello AC Terminal <span class="hljs-comment"># 引号可以忽略</span><br></code></pre></td></tr></table></figure>
<p><strong>显示转义字符</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;\&quot;Hello AC Terminal \&quot;&quot;</span> <span class="hljs-comment"># 注意只能使用双引号，如果使用单引号，则不转义</span><br><span class="hljs-built_in">echo</span> \&quot;Hello AC Terminal\&quot; <span class="hljs-comment"># 也可以忽略双引号</span><br></code></pre></td></tr></table></figure>
<p><strong>显示变量</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH">name=yxc<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;My name is <span class="hljs-variable">$name</span>&quot;</span> <span class="hljs-comment"># 输出 My name is yxc</span><br></code></pre></td></tr></table></figure>
<p><strong>显示换行</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;Hi\n&quot;</span> <span class="hljs-comment"># -e 开启转义</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;acwing&quot;</span><br></code></pre></td></tr></table></figure>
<p><strong>输出结果</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">Hi<br><br>acwing <br></code></pre></td></tr></table></figure>
<p><strong>实现不换行</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;Hi \c&quot;</span> <span class="hljs-comment"># -e 开启转义 \c 不换行</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;acwing&quot;</span><br></code></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">Hi acwing<br></code></pre></td></tr></table></figure>
<p><strong>显示结果定向文件</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello World&quot;</span> &gt; output.txt <span class="hljs-comment"># 将内容以覆盖的方式输出到output.txt中</span><br></code></pre></td></tr></table></figure>
<p><strong>原样输出字符串</strong>，不进行转义或取变量（用单引号）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH">name=acwing<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;$name\&quot;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-variable">$name</span>\&quot;<br></code></pre></td></tr></table></figure>
<p><strong>显示命令的执行结果</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">echo</span> `<span class="hljs-built_in">date</span>`<br></code></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Wed Sep 1 11:45:33 CST 2021<br></code></pre></td></tr></table></figure>
<h3 id="printf命令">printf命令</h3>
<p><code>printf</code>命令用于格式化输出，类似于C/C++中的<code>printf</code>函数。<br>
默认不会在字符串末尾添加换行符。<br>
命令格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">printf</span> format-string [arguments ...]<br></code></pre></td></tr></table></figure>
<p><strong>用法示例</strong><br>
脚本内容：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%10d.\n&quot;</span> 123 <span class="hljs-comment"># 占10位，右对齐</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;-10.2f.\n&quot;</span> 123.123321 <span class="hljs-comment"># 占10位，保留两位小数，左对齐 </span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;My name is %s\n&quot;</span> <span class="hljs-string">&quot;yxc&quot;</span> <span class="hljs-comment"># 格式化输出字符串</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%d * %d = %d\n&quot;</span> 2 3 `<span class="hljs-built_in">expr</span> 2 \* 3` <span class="hljs-comment"># 表达式的值作为参数</span><br></code></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH">       123.<br>123.12    .<br>My name is yxc<br>2 * 3 = 6<br></code></pre></td></tr></table></figure>
<h3 id="test命令与判断符号">test命令与判断符号</h3>
<p>逻辑运算符<code>&amp;&amp;</code>和<code>||</code></p>
<ul>
<li><code>&amp;&amp;</code>表示与，<code>||</code>表示或</li>
<li>二者具有短路原则：<code>expr1 &amp;&amp; expr2</code>:当<code>expr</code>为假时，直接忽略<code>expr2</code> <code>expr1 ||  expr2</code>:当<code>expr1</code>为真时，直接忽略<code>expr2</code></li>
<li>表达式<code>exit code</code>为<code>0</code>，表示真，为<code>非零</code>,表示假的<br>
<strong>test命令</strong><br>
在命令行中输入<code>man test</code>,可以直接查看test命令的用法。<br>
<code>test</code>命令用于判断文件类型，以及对变量做比较。<br>
<code>test</code>命令用<code>exit code</code>返回结果，而不是使用<code>stdout</code>.<code>0</code>表示<code>真</code>，<code>非0</code>表示<code>假</code><br>
例如：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">test</span> 2 -lt 3 <span class="hljs-comment"># 为真，返回值为0  </span><br><span class="hljs-built_in">echo</span> $? <span class="hljs-comment"># 输出上一个命令的返回值，输出0</span><br></code></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH">acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">ls</span>  <span class="hljs-comment"># 列出当前目录下的所有文件</span><br>homework  output.txt  test.sh  tmp<br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">test</span> -e test.sh &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;exist&quot;</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Not exist&quot;</span><br>exist  <span class="hljs-comment"># test.sh 文件存在</span><br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">test</span> -e test2.sh &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;exist&quot;</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Not exist&quot;</span><br>Not exist  <span class="hljs-comment"># testh2.sh 文件不存在</span><br></code></pre></td></tr></table></figure>
<p><strong>文件类型判断</strong><br>
命令格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">test -e filename # 判断文件是否存在<br></code></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">测试参数</th>
<th style="text-align:center">代表意义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>-e</code></td>
<td style="text-align:center">文件是否存在</td>
</tr>
<tr>
<td style="text-align:center"><code>-f</code></td>
<td style="text-align:center">是否为文件</td>
</tr>
<tr>
<td style="text-align:center"><code>-d</code></td>
<td style="text-align:center">是否为目录</td>
</tr>
</tbody>
</table>
<p><strong>文件权限判断</strong><br>
命令格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">test</span> -r filename <span class="hljs-comment"># 判断文件是否可读</span><br></code></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">测试参数</th>
<th style="text-align:center">代表意义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>-r</code></td>
<td style="text-align:center">文件是否可读</td>
</tr>
<tr>
<td style="text-align:center"><code>-w</code></td>
<td style="text-align:center">文件是否可写</td>
</tr>
<tr>
<td style="text-align:center"><code>-x</code></td>
<td style="text-align:center">文件是否可执行</td>
</tr>
<tr>
<td style="text-align:center"><code>-s</code></td>
<td style="text-align:center">是否是非空文件</td>
</tr>
</tbody>
</table>
<p><strong>整数间比较</strong><br>
命令格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">test</span> <span class="hljs-variable">$a</span> -eq <span class="hljs-variable">$b</span> <span class="hljs-comment"># a是否等于b</span><br></code></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">测试参数</th>
<th style="text-align:center">代表意义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>-eq</code></td>
<td style="text-align:center">a是否等于b</td>
</tr>
<tr>
<td style="text-align:center"><code>-ne</code></td>
<td style="text-align:center">a是否不等于b</td>
</tr>
<tr>
<td style="text-align:center"><code>-gt</code></td>
<td style="text-align:center">a是否大于b</td>
</tr>
<tr>
<td style="text-align:center"><code>-lt</code></td>
<td style="text-align:center">a是否小于b</td>
</tr>
<tr>
<td style="text-align:center"><code>-ge</code></td>
<td style="text-align:center">a是否大于等于b</td>
</tr>
<tr>
<td style="text-align:center"><code>-le</code></td>
<td style="text-align:center">a是否小于等于b</td>
</tr>
</tbody>
</table>
<p><strong>字符串比较</strong></p>
<p>| 测试参数 | 代表意义 |<br>
| <code>test -z STRING</code> |  判断<code>STRING</code>是否为空，如果为空，则返回true |<br>
| <code>test -n STRING</code> |  判断<code>STRING</code>是否为空，如果非空，则返回true (-n可以忽略) |<br>
| <code>test str1 == str2</code> | 判断<code>str1</code>是否等于<code>str2</code> |<br>
| <code>test str1 $\ne$ str2</code> | 判断<code>str1</code>是否等于<code>str2</code> |</p>
<p><strong>多重条件判定</strong><br>
命令格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">test</span> -r filename -a -x filename<br></code></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">测试参数</th>
<th style="text-align:center">代表意义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>-a</code></td>
<td style="text-align:center">两条件是否同时成立</td>
</tr>
<tr>
<td style="text-align:center"><code>-o</code></td>
<td style="text-align:center">两条件是否至少一个成立</td>
</tr>
<tr>
<td style="text-align:center"><code>!</code></td>
<td style="text-align:center">取反，如<code>test ! -x file</code>,当<code>file</code>不可执行时，返回true</td>
</tr>
</tbody>
</table>
<p><strong>判断符号[]</strong><br>
<code>[ ]</code>与<code>test</code>用法几乎一模一样，更常用于<code>if</code>语句中，另外<code>[[]]</code>是<code>[]</code>的加强版，支持的特性更多。<br>
例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs SH">[ 2 -lt 3 ]  <span class="hljs-comment"># 为真，返回值为0</span><br><span class="hljs-built_in">echo</span> $?  <span class="hljs-comment"># 输出上个命令的返回值，输出0</span><br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">ls</span>  <span class="hljs-comment"># 列出当前目录下的所有文件</span><br>homework  output.txt  test.sh  tmp<br>acs@9e0ebfcd82d7:~$ [ -e test.sh ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;exist&quot;</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Not exist&quot;</span><br>exist  <span class="hljs-comment"># test.sh 文件存在</span><br>acs@9e0ebfcd82d7:~$ [ -e test2.sh ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;exist&quot;</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Not exist&quot;</span><br>Not exist  <span class="hljs-comment"># testh2.sh 文件不存在</span><br></code></pre></td></tr></table></figure>
<p>注意：</p>
<ul>
<li><code>[ ]</code>内每一项都要用空格隔开</li>
<li>中括号内的变量最好用双引号括起来</li>
<li>中括号内的常数，最好用单或双引号括起来</li>
</ul>
<p>例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">name=<span class="hljs-string">&quot;acwing yxc&quot;</span><br>[ <span class="hljs-variable">$name</span> == <span class="hljs-string">&quot;acwing yxc&quot;</span> ] <span class="hljs-comment"># 错误，等价于[ acwing yxc == &quot;acwing yxc&quot; ],参数太多</span><br>[ <span class="hljs-string">&quot;<span class="hljs-variable">$name</span>&quot;</span> == <span class="hljs-string">&quot;acwing yxc&quot;</span> ] <span class="hljs-comment"># 正确  </span><br></code></pre></td></tr></table></figure>
<h3 id="判断语句">判断语句</h3>
<p><strong>if…then形式</strong><br>
类似于C/C++中的if-else语句。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-keyword">if</span> condition <br><span class="hljs-keyword">then</span> <br>    语句一<br>    语句二<br><span class="hljs-keyword">elif</span> condition<br><span class="hljs-keyword">then</span> <br>    语句一<br>    语句二<br>    ...<br><span class="hljs-keyword">elif</span> condition<br><span class="hljs-keyword">then</span> <br>    语句一<br>    语句二<br><span class="hljs-keyword">else</span><br>    语句一<br>    语句二<br>    ...<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>
<p><strong>case…esac形式</strong><br>
类似于C/C++中的switch语句</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-keyword">case</span> $变量名称 <span class="hljs-keyword">in</span><br>    值1）<br>语句一<br>语句二<br>...<br>;; <span class="hljs-comment"># 类似于C/C++中的break</span><br>    值2）<br>语句一<br>语句二<br>...<br>;;<br>    *)  <span class="hljs-comment"># 类似于C/C++中的defalut</span><br>语句一<br>语句二<br>...<br>;;<br><span class="hljs-keyword">esac</span><br></code></pre></td></tr></table></figure>
<h3 id="循环语句">循环语句</h3>
<p><strong>for…in…都…done</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-keyword">for</span> var <span class="hljs-keyword">in</span> val1 val2 val3<br><span class="hljs-keyword">do</span> <br>    语句1<br>    语句2<br>    ...<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
<p>示例1，输出<code>a 2 cc</code>，每个元素一行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a 2 cc <br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
<p>示例2，输出当前路径下的所有文件名，每个文件名一行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span>  `<span class="hljs-built_in">ls</span>`<br><span class="hljs-keyword">do</span> <br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$file</span><br></code></pre></td></tr></table></figure>
<p>示例3，输出<code>1-10</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 1 10)<br><span class="hljs-keyword">do</span> <br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
<p>示例4，使用{1…10}或者{a…z}</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;a...z&#125;<br><span class="hljs-keyword">do</span> <br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
<p><strong>for((…;…;…))do…done</strong><br>
命令格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-keyword">for</span> ((expression; condition; expression))<br><span class="hljs-keyword">do</span> <br>    语句1<br>    语句2<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
<p><strong>while…do…done循环</strong><br>
命令格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-keyword">while</span> condition<br><span class="hljs-keyword">do</span> <br>    语句1<br>    语句2<br>    ...<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
<p>示例，文件结束符为<code>Ctrl+d</code>，输入文件结束符后<code>read</code>指令后返回</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> name<br><span class="hljs-keyword">do</span> <br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$name</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
<p><strong>死循环的处理方式</strong><br>
如果AC Terminal可以打开该程序，则输入<code>Ctrl+c</code>即可<br>
否则可以直接关闭进程：<br>
使用<code>top</code>命令找到该进程<code>PID</code><br>
输入<code>kill -9 PID</code>即可关掉此进程</p>
<h3 id="函数">函数</h3>
<p><code>bash</code>中的函数类似于C/C++中的函数<br>
但<code>return</code>的返回值与与C/C++不同，返回的是<code>exit code</code>,取值为<code>0-255</code>,<code>0</code>表示正常结束<br>
如果想要获取函数的输出结果，可以通过<code>echo</code>输出到<code>stdout</code>中<br>
然后通过<code>$(function_name)</code>来获取<code>stdout</code>中的结果。<br>
函数<code>return</code>值可以通过<code>$?</code>来获取<br>
命令格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SH">[<span class="hljs-keyword">function</span>] <span class="hljs-function"><span class="hljs-title">func_name</span></span>() &#123; <span class="hljs-comment"># function关键字可以省略</span><br>    语句1<br>    语句2<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>不获取return和stdout值</strong><br>
示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-function"><span class="hljs-title">func</span></span>() &#123;<br>    name = yxc<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello <span class="hljs-variable">$name</span>&quot;</span><br>&#125;<br><br>func<br></code></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">Hello yxc<br></code></pre></td></tr></table></figure>
<p><strong>获取return值和stdout值</strong><br>
不写return时，默认return 0<br>
示例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-function"><span class="hljs-title">func</span></span>() &#123;<br>    name=yxc<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello <span class="hljs-variable">$name</span>&quot;</span><br><br>    <span class="hljs-built_in">return</span> 123<br>&#125;<br><br>output=$(func)<br>ret=$?<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ouput=<span class="hljs-variable">$ouput</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;return=<span class="hljs-variable">$ret</span>&quot;</span><br></code></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH">output=Hello yxc<br><span class="hljs-built_in">return</span> = 123<br></code></pre></td></tr></table></figure>
<p><strong>函数的输入参数</strong><br>
在函数中，<code>$1</code>表示第一个输入参数，<code>$2</code>表示第二个输入参数，以此类推<br>
注意：函数内<code>$0</code>仍然是文件名，而不是函数名<br>
示例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-function"><span class="hljs-title">func</span></span>() &#123; <span class="hljs-comment"># 递归计算$1 + ($1 - 1) + ($1 - 2) + ... + 0</span><br>    word = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">while</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;word&#125;</span>&quot;</span> != <span class="hljs-string">&#x27;y&#x27;</span> ] &amp;&amp; [ <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;word&#125;</span>&quot;</span> != <span class="hljs-string">&#x27;n&#x27;</span> ]<br>    <span class="hljs-keyword">do</span> <br>        <span class="hljs-built_in">read</span> -p <span class="hljs-string">&quot;要进入func(<span class="hljs-variable">$1</span>)函数吗？请输入y/n:&quot;</span> word<br>    <span class="hljs-keyword">done</span><br><br>    <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$word</span>&quot;</span> == <span class="hljs-string">&#x27;n&#x27;</span> ]<br>    <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> 0<br>        <span class="hljs-built_in">return</span> 0<br>    <span class="hljs-keyword">fi</span><br><br>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$1</span> -le 0 ]<br>    <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> 0<br>        <span class="hljs-built_in">return</span> 0<br>    <span class="hljs-keyword">fi</span><br><br>    <span class="hljs-built_in">sum</span> = $(func $(<span class="hljs-built_in">expr</span> <span class="hljs-variable">$1</span> - 1))<br>    <span class="hljs-built_in">echo</span> $(<span class="hljs-built_in">expr</span> <span class="hljs-variable">$sum</span> + <span class="hljs-variable">$1</span>)   <br>&#125;<br><br><span class="hljs-built_in">echo</span> $(func 10)<br></code></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">55<br></code></pre></td></tr></table></figure>
<p><strong>函数内的局部变量</strong><br>
可以在函数内定义局部变量，作用范围仅在当前函数内。<br>
可以在递归函数中定义局部变量<br>
命令格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">local</span> 变量名=变量值<br></code></pre></td></tr></table></figure>
<p>例如</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash  </span><br><br><span class="hljs-function"><span class="hljs-title">func</span></span>() &#123;<br>    <span class="hljs-built_in">local</span> name = yxc <br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$name</span><br>&#125;<br><br>func <span class="hljs-comment"># 第一次在函数内调用(有)</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$name</span> <span class="hljs-comment"># 第二次在函数外调用(无)</span><br></code></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">yxc<br></code></pre></td></tr></table></figure>
<p>第一行为函数内的<code>name</code>变量，第二行行为函数外调用<code>name</code>变量，会发现此时变量不存在</p>
<h3 id="exit命令">exit命令</h3>
<p><code>exit</code>命令用来退出当前<code>shell</code>进程，并返回一个退出状态；使用<code>$?</code>可以接收这个退出状态。<br>
<code>exit</code>命令可以接受一个整数值作为参考，代表退出状态。如果不指定，默认状态是<code>0</code>.<br>
<code>exit</code>退出状态只能是一个介于<code>0~255</code>之间的整数，其中只有<code>0</code>表示成功，其他值都表示失败。</p>
<blockquote>
<p><code>return</code>和<code>exit</code>的共同之处都是返回<code>exit code</code>，区别是<code>return</code>结束当前函数，<code>exit</code>结束整个<code>shell</code>脚本<br>
示例：<br>
创建脚本<code>test.sh</code>,内容如下：</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash  </span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne 1 ] <span class="hljs-comment"># 如果传入参数个数等于1，则正常退出；否则非正常退出。</span><br><span class="hljs-keyword">then</span> <br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;arguments not valid&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">else</span> <br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;arguments valid&quot;</span><br>    <span class="hljs-built_in">exit</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>
<p>执行该脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs SH">acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">chmod</span> +x test.sh <br>acs@9e0ebfcd82d7:~$ ./test.sh acwing<br>arguments valid<br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">echo</span> $?  <span class="hljs-comment"># 传入一个参数，则正常退出，exit code为0</span><br>0<br>acs@9e0ebfcd82d7:~$ ./test.sh <br>arguments not valid<br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">echo</span> $?  <span class="hljs-comment"># 传入参数个数不是1，则非正常退出，exit code为1</span><br>1<br></code></pre></td></tr></table></figure>
<h3 id="文件重定向">文件重定向</h3>
<p>每次进程默认打开3个文件描述符：</p>
<ul>
<li><code>stdin</code> 标准输入，从命令行读取数据，文件描述符为<code>0</code></li>
<li><code>stdout</code> 标准输出，从命令行输出数据，文本描述符为<code>1</code></li>
<li><code>stderr</code> 标准错误输出，向命令行输出文件，文本描述符为<code>2</code></li>
</ul>
<p>可以用文件重定向将这三个文件重定向到其他文件中。<br>
<strong>重定向命令列表</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">命令</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>commmand &gt; file</code></td>
<td style="text-align:center">将<code>stdout</code>重定向到<code>file</code>中</td>
</tr>
<tr>
<td style="text-align:center"><code>commmand &lt; file</code></td>
<td style="text-align:center">将<code>stdin</code>重定向到<code>file</code>中</td>
</tr>
<tr>
<td style="text-align:center"><code>commmand &gt;&gt; file</code></td>
<td style="text-align:center">将<code>stdout</code>以追加方式重定向到<code>file</code>中</td>
</tr>
<tr>
<td style="text-align:center"><code>commmand n&gt; file</code></td>
<td style="text-align:center">将文件描述符<code>n</code>重定向到<code>file</code>中</td>
</tr>
<tr>
<td style="text-align:center"><code>commmand n&gt;&gt; file</code></td>
<td style="text-align:center">将文件描述符<code>n</code>以追加方式重定向到<code>file</code>中</td>
</tr>
</tbody>
</table>
<p><strong>输入和输出重定向</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;Hello \c&quot;</span> &gt; output.txt <span class="hljs-comment"># 将stdout重定向到output.txt中  </span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;World&quot;</span> &gt;&gt; output.txt <span class="hljs-comment"># 将字符串追加到output.txt中  </span><br><br><span class="hljs-built_in">read</span> str &lt; output.txt <span class="hljs-comment"># 从output.txt中读取字符串  </span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$str</span> <span class="hljs-comment"># 输出结果 Hello World</span><br></code></pre></td></tr></table></figure>
<p><strong>同时重新定向stdin和stdout</strong><br>
创建bash脚本:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash</span><br><br><span class="hljs-built_in">read</span> a<br><span class="hljs-built_in">read</span> b<br><br><span class="hljs-built_in">echo</span> $(<span class="hljs-built_in">expr</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span>&quot;</span> + <span class="hljs-string">&quot;<span class="hljs-variable">$b</span>&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>创建input.txt，里面内容为：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH">3<br>4<br></code></pre></td></tr></table></figure>
<p>执行命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH">acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">chmod</span> +x test.sh  <span class="hljs-comment"># 添加可执行权限</span><br>acs@9e0ebfcd82d7:~$ ./test.sh &lt; input.txt &gt; output.txt  <span class="hljs-comment"># 从input.txt中读取内容，将输出写入output.txt中</span><br>acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">cat</span> output.txt  <span class="hljs-comment"># 查看output.txt中的内容</span><br>7   <br></code></pre></td></tr></table></figure>
<h3 id="引入外部脚本">引入外部脚本</h3>
<p>类似于C/C++中的<code>include</code>操作，<code>bash</code>也可以引入其他文件中的代码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">. filename <span class="hljs-comment"># 注意点和文件名之间有一个空格</span><br></code></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash</span><br><br>name=yxc <span class="hljs-comment"># 定义变量name</span><br></code></pre></td></tr></table></figure>
<p>然后创建<code>test2.sh</code>，内容为：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash</span><br><br><span class="hljs-built_in">source</span> test1.sh <span class="hljs-comment"># 或. test1.sh</span><br><br><span class="hljs-built_in">echo</span> My name is: <span class="hljs-variable">$name</span> <span class="hljs-comment"># 可以使用使用test1.sh中的变量  </span><br></code></pre></td></tr></table></figure>
<p>执行命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">acs@9e0ebfcd82d7:~$ <span class="hljs-built_in">chmod</span> +x test2.sh<br>acs@9e0ebfcd82d7:~$ ..test2.sh<br>My name is: yxc<br></code></pre></td></tr></table></figure>
<h3 id="作业-3">作业</h3>
<ol start="0">
<li>进入 homework_0 文件夹，编写自动完成 lesson_1 作业的脚本 <a target="_blank" rel="noopener" href="http://helper.sh">helper.sh</a> 。要求：
<ol>
<li>当前目录下仅包含 <a target="_blank" rel="noopener" href="http://helper.sh">helper.sh</a></li>
<li>helper.sh具有可执行权限</li>
<li>在任意路径依次执行下列命令后，lesson_1 的作业可以得到满分：
<ol>
<li>homework 1 create</li>
<li>/home/acs/homework/lesson_3/homework_0/helper.sh</li>
</ol>
</li>
</ol>
</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash</span><br><br><span class="hljs-comment"># homework0</span><br>homework 1 create 0<br>dir0=/home/acs/homework/lesson_1/homework_0<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> dir_a dir_b dir_c<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$&#123;dir0&#125;</span>/<span class="hljs-variable">$i</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># homework1</span><br>homework 1 create 1<br>dir1=/home/acs/homework/lesson_1/homework_1<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a b c<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">cp</span> <span class="hljs-variable">$&#123;dir1&#125;</span>/<span class="hljs-variable">$&#123;i&#125;</span>.txt <span class="hljs-variable">$&#123;dir1&#125;</span>/<span class="hljs-variable">$&#123;i&#125;</span>.txt.bak<br><span class="hljs-keyword">done</span><br><span class="hljs-comment"># homework2</span><br>homework 1 create 2<br>dir2=/home/acs/homework/lesson_1/homework_2<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a b c<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">mv</span> <span class="hljs-variable">$&#123;dir2&#125;</span>/<span class="hljs-variable">$&#123;i&#125;</span>.txt <span class="hljs-variable">$&#123;dir2&#125;</span>/<span class="hljs-variable">$&#123;i&#125;</span>_new.txt<br><span class="hljs-keyword">done</span><br><span class="hljs-comment"># homework3</span><br>homework 1 create 3<br>dir3=/home/acs/homework/lesson_1/homework_3<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a b c<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">mv</span> <span class="hljs-variable">$&#123;dir3&#125;</span>/dir_a/<span class="hljs-variable">$&#123;i&#125;</span>.txt <span class="hljs-variable">$&#123;dir3&#125;</span>/dir_b<br><span class="hljs-keyword">done</span><br><span class="hljs-comment"># homework4</span><br>homework 1 create 4<br>dir4=/home/acs/homework/lesson_1/homework_4<br><span class="hljs-built_in">rm</span> <span class="hljs-variable">$&#123;dir4&#125;</span>/*.txt<br><span class="hljs-comment"># homework5</span><br>homework 1 create 5<br>dir5=/home/acs/homework/lesson_1/homework_5<br><span class="hljs-built_in">rm</span> <span class="hljs-variable">$&#123;dir5&#125;</span>/dir_* -r<br><span class="hljs-comment"># homework6</span><br>homework 1 create 6<br>dir6=/home/acs/homework/lesson_1/homework_6<br><span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$&#123;dir6&#125;</span>/dir_a<br><span class="hljs-built_in">mv</span> <span class="hljs-variable">$&#123;dir6&#125;</span>/task.txt <span class="hljs-variable">$&#123;dir6&#125;</span>/dir_a/<span class="hljs-string">&quot;done.txt&quot;</span><br><span class="hljs-comment"># homework7</span><br>homework 1 create 7<br>dir7=/home/acs/homework/lesson_1/homework_7<br><span class="hljs-keyword">for</span> ((i=0;i&lt;=2;i++))<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$&#123;dir7&#125;</span>/dir_<span class="hljs-variable">$&#123;i&#125;</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> a b c<br>    <span class="hljs-keyword">do</span><br>        <span class="hljs-built_in">cp</span> <span class="hljs-variable">$&#123;dir7&#125;</span>/<span class="hljs-variable">$&#123;j&#125;</span>.txt <span class="hljs-variable">$&#123;dir7&#125;</span>/dir_<span class="hljs-variable">$&#123;i&#125;</span>/<span class="hljs-variable">$&#123;j&#125;</span><span class="hljs-variable">$&#123;i&#125;</span>.txt<br>    <span class="hljs-keyword">done</span><br><span class="hljs-keyword">done</span><br><span class="hljs-comment"># homewrok8</span><br>homework 1 create 8<br>dir8=/home/acs/homework/lesson_1/homework_8<br><span class="hljs-built_in">rm</span> <span class="hljs-variable">$&#123;dir8&#125;</span>/dir_a/a.txt<br><span class="hljs-built_in">mv</span> <span class="hljs-variable">$&#123;dir8&#125;</span>/dir_b/b.txt <span class="hljs-variable">$&#123;dir8&#125;</span>/dir_b/b_new.txt<br><span class="hljs-built_in">cp</span> <span class="hljs-variable">$&#123;dir8&#125;</span>/dir_c/c.txt <span class="hljs-variable">$&#123;dir8&#125;</span>/dir_c/c.txt.bak<br><span class="hljs-comment"># homework9</span><br>homework 1 create 9<br>dir9=/home/acs/homework/lesson_1/homework_9<br><span class="hljs-built_in">rm</span> <span class="hljs-variable">$&#123;dir9&#125;</span>/*.txt<br>```  <br>1. 进入 homework_1 文件夹，编写脚本 check_file.sh。要求： 1. 当前目录下仅包含 check_file.sh 。 2. check_file.sh 具有可执行权限。 3. check_file.sh 接收一个传入参数。格式为 ./check_file.sh file 4. 判断传递参数，分别在标准输出中输出如下内容（不包括双引号）： 1. 如果传入参数个数不是 1 ，则输出一行：<span class="hljs-string">&quot;arguments not valid&quot;</span>，然后退出，退出状态等于 1。 2. 如果 file 文件不存在，则输出一行：<span class="hljs-string">&quot;not exist&quot;</span>，然后退出，退出状态等于 2 。 3. 如果 file 文件存在，则输出分别进行如下 5 个判断，然后退出，退出状态等于 0 。 1. 如果 file 为普通文件，则输出一行：<span class="hljs-string">&quot;regular file&quot;</span> 2. 如果 file 为目录（文件夹），则输出一行：<span class="hljs-string">&quot;directory&quot;</span> 3. 如果 file 具有可读权限，则输出一行：<span class="hljs-string">&quot;readable&quot;</span> 4. 如果 file 具有可写权限，则输出一行：<span class="hljs-string">&quot;writable&quot;</span> 5. 如果 file 具有可执行权限，则输出一行：<span class="hljs-string">&quot;executable&quot;</span><br>```SH<br><span class="hljs-comment">#! /bin/bash</span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne 1 ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> arguments not valid<br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> not exist<br>    <span class="hljs-built_in">exit</span> 2<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> regular file<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ -d <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> directory<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ -r <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> readable<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ -w <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> writable<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ -x <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> executable<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>进入 homework_2 文件夹，编写脚本 <a target="_blank" rel="noopener" href="http://main.sh">main.sh</a>。要求：
<ol>
<li>当前目录下仅包含 <a target="_blank" rel="noopener" href="http://main.sh">main.sh</a></li>
<li><a target="_blank" rel="noopener" href="http://main.sh">main.sh</a> 具有可执行权限</li>
<li>该文件从 stdin (标准输入)中读取一个整数 n</li>
<li>在 stdout (标准输出)输出斐波那契数列的第 n 项。即：a[0] = 1, a[1] = 1, a[i] = a[i - 1] + a[i - 2], 求 a[n]</li>
<li>数据保证 $0 \leq n \leq 20$，脚本不需要判断 n 的合法性。</li>
</ol>
</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash</span><br><br><span class="hljs-built_in">read</span> n<br><br>a[0]=1<br>a[1]=1<br><br><span class="hljs-keyword">for</span> ((i = 2; i &lt;= n; i ++ ))<br><span class="hljs-keyword">do</span><br>    x=$(<span class="hljs-built_in">expr</span> <span class="hljs-variable">$i</span> - 1)<br>    y=$(<span class="hljs-built_in">expr</span> <span class="hljs-variable">$i</span> - 2)<br>    a[<span class="hljs-variable">$i</span>]=$(<span class="hljs-built_in">expr</span> <span class="hljs-variable">$&#123;a[$x]&#125;</span> + <span class="hljs-variable">$&#123;a[$y]&#125;</span>)<br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;a[$n]&#125;</span><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>进入 homework_3 文件夹，编写脚本 <a target="_blank" rel="noopener" href="http://main.sh">main.sh</a>。要求：
<ol>
<li>当前目录下仅包含 <a target="_blank" rel="noopener" href="http://main.sh">main.sh</a></li>
<li><a target="_blank" rel="noopener" href="http://main.sh">main.sh</a> 具有可执行权限</li>
<li>该文件从 stdin (标准输入)中读取两行整数 n 和 m</li>
<li>在 stdout (标准输出)中输出 1~n 的按字典序从小到大的顺序数第 m 个全排列，输出一行，用空格隔开所有数，行末可以有多余空格</li>
<li>数据保证 1 &lt;= n &lt;= 10, 1 &lt;= m &lt;= min(100, n!)，脚本不需要判断数据的合法性</li>
</ol>
</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash</span><br><br><span class="hljs-built_in">read</span> n<br><span class="hljs-built_in">read</span> m<br><br><span class="hljs-keyword">for</span> ((i = 1; i &lt;= n; i ++ ))<br><span class="hljs-keyword">do</span><br>    st[<span class="hljs-variable">$i</span>]=0<br><span class="hljs-keyword">done</span><br><br><span class="hljs-function"><span class="hljs-title">dfs</span></span>() &#123;<br>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$1</span> -eq <span class="hljs-variable">$n</span> ]<br>    <span class="hljs-keyword">then</span><br>        m=`<span class="hljs-built_in">expr</span> <span class="hljs-variable">$m</span> - 1`<br>        <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$m</span> -eq 0 ] <br>        <span class="hljs-keyword">then</span><br>            <span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;path[@]&#125;</span><br>            <span class="hljs-built_in">return</span> 0<br>        <span class="hljs-keyword">fi</span><br>        <span class="hljs-built_in">return</span> 1<br>    <span class="hljs-keyword">fi</span>  <br><br>    <span class="hljs-built_in">local</span> j=0<br>    <span class="hljs-keyword">for</span> ((j = 1; j &lt;= n; j ++ ))<br>    <span class="hljs-keyword">do</span>  <br>        <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;st[$j]&#125;</span> -eq 0 ] <br>        <span class="hljs-keyword">then</span><br>            path[<span class="hljs-variable">$1</span>]=<span class="hljs-variable">$j</span><br>            st[<span class="hljs-variable">$j</span>]=1<br><br>            <span class="hljs-keyword">if</span> dfs `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$1</span> + 1`<br>            <span class="hljs-keyword">then</span><br>                <span class="hljs-built_in">return</span> 0<br>            <span class="hljs-keyword">fi</span><br><br>            st[<span class="hljs-variable">$j</span>]=0<br>        <span class="hljs-keyword">fi</span><br>    <span class="hljs-keyword">done</span><br><br>    <span class="hljs-built_in">return</span> 1<br>&#125;<br><br><br>dfs 0<br><br></code></pre></td></tr></table></figure>
<ol start="4">
<li>进入 homework_4 文件夹，编写脚本 <a target="_blank" rel="noopener" href="http://main.sh">main.sh</a> 。要求：
<ol>
<li>当前目录下仅包含 <a target="_blank" rel="noopener" href="http://main.sh">main.sh</a></li>
<li><a target="_blank" rel="noopener" href="http://main.sh">main.sh</a> 具有可执行权限</li>
<li><a target="_blank" rel="noopener" href="http://main.sh">main.sh</a> 接收两个传入参数。格式为 ./main.sh input_file output_file</li>
<li>从 input_file 中读取一个正整数 n，然后将前 n 个正整数的平方和写入 output_file 中</li>
<li>数据保证 $1 \leq n \leq 100$，脚本不需要判断所有数据的合法性</li>
</ol>
</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash</span><br><br>input_file=<span class="hljs-variable">$1</span><br>output_file=<span class="hljs-variable">$2</span><br><br><span class="hljs-built_in">read</span> n &lt; <span class="hljs-variable">$input_file</span><br><br><br><span class="hljs-built_in">sum</span>=0<br><br><span class="hljs-keyword">for</span> ((i = 1; i &lt;= n; i ++ ))<br><span class="hljs-keyword">do</span><br>    sqr=`<span class="hljs-built_in">expr</span> <span class="hljs-variable">$i</span> \* <span class="hljs-variable">$i</span>`<br>    <span class="hljs-built_in">sum</span>=`<span class="hljs-built_in">expr</span> <span class="hljs-variable">$sum</span> + <span class="hljs-variable">$sqr</span>`<br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$sum</span> &gt; <span class="hljs-variable">$output_file</span><br></code></pre></td></tr></table></figure>
<h2 id="ssh">ssh</h2>
<h3 id="ssh登陆">ssh登陆</h3>
<p><strong>基本用法</strong><br>
远程登陆服务器：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">ssh user@hostname<br></code></pre></td></tr></table></figure>
<ul>
<li>name: 用户名</li>
<li>hostname: IP地址或域名</li>
</ul>
<p>第一次登录会提示：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">The authenticity of host <span class="hljs-string">&#x27;123.57.47.211 (123.57.47.211)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ECDSA key fingerprint is SHA256:iy237yysfCe013/l+kpDGfEG9xxHxm0dnxnAbJTPpG8.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])?</span><br></code></pre></td></tr></table></figure>
<p>输入<code>yes</code>，然后回车即可。<br>
这样会将该服务器的信息记录到<code>~/.ssh/known_hosts</code>文件中。<br>
然后输入密码即可登录到远程服务器中。<br>
默认端口号为22.如果想登录到某一特定端口：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">ssh user@hostname -p 22<br></code></pre></td></tr></table></figure>
<p><strong>配置文件</strong><br>
创建文件<code>~/.ssh/config</code><br>
然后在文件中输入：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs SH">Host myserver1<br>    HostName IP地址或域名<br>    User 用户名<br><br>Host myserver2<br>    HostName IP地址或域名<br>    User 用户名<br></code></pre></td></tr></table></figure>
<p>之后再使用服务器时，可以直接使用别名<code>myserver1,myserver2</code><br>
<strong>密钥登录</strong><br>
创建密钥：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">ssh-keygen<br></code></pre></td></tr></table></figure>
<p>然后一直回车即可<br>
执行结束后，<code>~/.ssh/</code>目录下会有多个文件：</p>
<ul>
<li><code>id_rsa</code>:私钥</li>
<li><code>id_rsa.pub</code>:公钥<br>
之后想免密登录哪个服务器，就将公钥传给哪个服务器即可。<br>
例如，想要免密登录myserver服务器。则将公钥中的内容，复制到<code>myserver</code>中的<code>~/.ssh/authorized_keys</code>文件中里即可。<br>
也可以使用如下命令一键添加公钥：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">ssh-copy-id myserver<br></code></pre></td></tr></table></figure>
<p><strong>执行命令</strong><br>
命令格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">ssh user@hostname <span class="hljs-built_in">command</span><br></code></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">ssh user@hostname <span class="hljs-built_in">ls</span> -a<br></code></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-comment"># 单引号中的$i可以求值  </span><br>ssh myserver <span class="hljs-string">&#x27;for ((i = 0; i &lt; 10; i ++ )) do echo $i; done&#x27;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意<br>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">a=1<br>ssh myserver <span class="hljs-string">&quot;echo <span class="hljs-variable">$a</span>&quot;</span><br>ssh myserver <span class="hljs-string">&#x27;echo $a&#x27;</span><br></code></pre></td></tr></table></figure><br>
双引号是在本地服务器进行转义了，所以传过去的命令不是<code>echo $a</code>,而是<code>echo 1</code>单引号传过去的是<code>echo $a</code></p>
</blockquote>
<h3 id="scp-传文件">scp 传文件</h3>
<p><strong>基本用法</strong><br>
命令格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">scp <span class="hljs-built_in">source</span> destination<br></code></pre></td></tr></table></figure>
<blockquote>
<p>【注意】 myserver是默认定位到用户的家目录</p>
</blockquote>
<p>将<code>soruce</code>路径下的文件复制到<code>destination</code>中<br>
<strong>一次复制多个文件：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">scp soruce1 soruce2 destination<br></code></pre></td></tr></table></figure>
<p><strong>复制文件夹</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">scp -r ~/tmp myserver:/home/acs/<br></code></pre></td></tr></table></figure>
<p>将本地家目录中的<code>tmp</code>文件夹复制到<code>myserver</code>服务器中的<code>/home/acs/</code>目录下。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">scp -r ~/tmp myserver:homework/acs/<br></code></pre></td></tr></table></figure>
<p>将本地家目录的<code>tmp</code>文件夹复制到<code>myserver</code>服务器中的<code>~/homework/</code>目录下面</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH">scp -r myserver:homework .<br>```SH<br>将`myserver`服务器中的`~/homework/`文件夹复制到本地的当前路径下。  <br>指定服务器的端口号：<br>```SH<br>scp -p 22 soruce1 soruce2 destination<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意：<code>scp</code>的<code>-r -P</code>等参数尽量加在<code>source</code>和<code>destination</code>之间。<br>
使用<code>scp</code>配置其他服务器的<code>vim</code>和<code>tmux</code></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">scp ~/.vimrc ~/.tmux.conf myserver:<br></code></pre></td></tr></table></figure>
<h3 id="作业-4">作业</h3>
<p>(0) 进入homework_0文件夹，要求：<br>
[1] 该文件夹内容为空<br>
[2] 配置服务器账号的密钥登陆方式。服务器信息可以通过如下命令获得：<br>
homework 4 getinfo<br>
将服务器账号的名称（Host）配置成：myserver<br>
<strong>配置服务器别名</strong><br>
在<code>~/.ssh</code>目录下创建文件：<code>config</code><br>
内容：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">Host myserver<br>    HostName 123.57.47.211<br>    User acs_2349<br></code></pre></td></tr></table></figure>
<p><strong>配置密钥登陆</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH">ssh-keygen<br>ssh-copy-id myserver<br></code></pre></td></tr></table></figure>
<p>(1) 进入homework_1文件夹，下列描述中的“本地”均表示当前文件夹。要求：<br>
[1] 在myserver服务器上创建并清空文件夹：~/homework/lesson_4/homework_1/<br>
[2] 将本地的main.cpp文件上传到myserver中的~/homework/lesson_4/homework_1/目录中。<br>
[3] 在本地创建文件夹dir。<br>
[4] 将myserver中的/etc/lsb-release文件复制到dir中。<br>
<strong>在myserver端</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">mkdir</span> ~/homework/lesson_4/homework_1/ -p<br></code></pre></td></tr></table></figure>
<p><strong>在本地</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH">scp main.cpp myserver:homework/lesson_4/homework_1<br><span class="hljs-built_in">mkdir</span> <span class="hljs-built_in">dir</span><br>scp myserver:/etc/lsb-release <span class="hljs-built_in">dir</span><br></code></pre></td></tr></table></figure>
<p>(2) 进入homework_2文件夹，下列描述中的“本地”均表示当前文件夹，要求：<br>
[1] 在myserver服务器上创建并清空文件夹：~/homework/lesson_4/homework_2/<br>
[2] 将本地的dir文件夹上传到myserver中的~/homework/lesson_4/homework_2/目录中。<br>
<strong>在myserver端</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> homework/lesson_4<br><span class="hljs-built_in">mkdir</span> homework_2<br></code></pre></td></tr></table></figure>
<p><strong>在本地</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">scp -r <span class="hljs-built_in">dir</span>/ myserver:homework/lesson_4/homework_2<br></code></pre></td></tr></table></figure>
<p>(3) 进入homework_3文件夹，下列描述中的“本地”均表示当前文件夹，要求：<br>
[1] 在本地创建文件夹dir。<br>
[2] 将myserver中的/var/lib/locales/supported.d文件夹下载到本地dir文件夹中。<br>
<strong>在本地</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">mkdir</span> <span class="hljs-built_in">dir</span><br>scp -r myserver:/var/lib/locales/supported.d <span class="hljs-built_in">dir</span><br></code></pre></td></tr></table></figure>
<p>(4) 进入homework_4文件夹，编写脚本remote_mkdir.sh和remote_rmdir.sh，要求：<br>
[1] 在myserver服务器上创建并清空文件夹：~/homework/lesson_4/homework_4/<br>
[2] 本地目录下仅包含remote_mkdir.sh和remote_rmdir.sh<br>
[3] remote_mkdir.sh和remote_rmdir.sh具有可执行权限<br>
[4] remote_mkdir.sh接收一个传入参数。格式为 ./remote_mkdir.sh directory_name<br>
该操作可以在myserver服务器上的~/homework/lesson_4/homework_4/目录下，创建一个名为directory_name的文件夹<br>
[5] remote_rmdir.sh接收一个传入传输。格式为 ./remote_rmdir.sh directory_name<br>
该操作可以将myserver服务器上的~/homework/lesson_4/homework_4/目录下的名为directory_name的文件夹删掉。<br>
[6] 注意：传入的文件参数可能包含空格。两个脚本均不需要判断传入参数的合法性。<br>
<strong>remote_mkdir.sh</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash</span><br><br>ssh myserver <span class="hljs-built_in">mkdir</span> homework/lesson_4/homework_4/\&quot;<span class="hljs-variable">$1</span>\&quot;<br></code></pre></td></tr></table></figure>
<p><strong>remote_rmdir.sh</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-meta">#! /bin/bash</span><br><br>ssh myserver <span class="hljs-built_in">rm</span> homework/lesson_4/homework_4/\&quot;<span class="hljs-variable">$1</span>\&quot; -r<br></code></pre></td></tr></table></figure>
<h2 id="git">git</h2>
<p>代码托管平台：<a href="git.acwing.com">git.acwing.com</a></p>
<h3 id="git基本概念">git基本概念</h3>
<ul>
<li>工作区：仓库的目录。工作区是独立于各个分支的。</li>
<li>暂存区：数据暂时存放的区域，类似于工作区写入版本库前的缓存区。暂存区是独立于各个分支的。</li>
<li>版本库：存放所有已经提交到本地仓库的代码版本</li>
<li>版本结构：树结构，树中每个节点代表一个代码版本。</li>
</ul>
<h3 id="git常用命令">git常用命令</h3>
<p><code>git config --global user.name xxx :</code> 设置全局用户名，信息记录在 ~/.gitconfig 文件中</p>
<p><code>git config --global user.email xxx@xxx.com : </code>设置全局邮箱地址，信息记录在 ~/.gitconfig 文件中</p>
<h3 id="git-单分支基本指令">git 单分支基本指令</h3>
<p><code>git init :</code> 将当前目录配置成<code> git</code> 仓库，信息记录在隐藏的 <code>.git</code> 文件夹中</p>
<p><code>git add XX :</code> 将 <code>XX</code> 文件添加到 暂存区</p>
<p><code>git add . :</code> 将所有待加入 <code>暂存区</code> 的文件加入 <code>暂存区</code> (<code>.</code> 可以用 <code>*</code> 代替)</p>
<p><code>git rm --cached XX :</code> 将文件从 <code>仓库索引目录</code> 中 <code>删掉</code></p>
<p><code>git commit -m &quot;给自己看的备注信息&quot;</code> : 将 暂存区 的内容 提交 到 当前分支</p>
<p><code>git status :</code> 查看仓库 状态</p>
<p><code>git diff XX :</code> 查看 XX 文件相对于 暂存区 修改了哪些内容</p>
<h3 id="git-单分支版本切换指令">git 单分支版本切换指令</h3>
<p><code>git log :</code> 查看当前分支的 所有版本</p>
<p><code>git log --pretty=oneline:</code>单行展示</p>
<p><code>git reflog :</code> 查看 HEAD指针 的 移动历史（包括被回滚的版本，这是回滚后再回来的方法）</p>
<p><code>git reset --hard HEAD^ 或 git reset --hard HEAD~ :</code> 将代码库 回滚 到 上一个版本</p>
<p><code>git reset --hard HEAD^^ :</code> 往上 回滚 两次，以此类推（几个 ^ 就回滚几次）</p>
<p><code>git reset --hard HEAD~100 :</code> 往上 回滚 100个版本，以此类推（~n 回滚 n 次）</p>
<p><code>git reset --hard 版本号 :</code> 回滚 到某一特定版本</p>
<p><code>git checkout — XX 或 git restore XX :</code> 将 XX 文件 尚未加入暂存区 的修改 全部撤销</p>
<h3 id="git-单分支与远程仓库交互的指令">git 单分支与远程仓库交互的指令</h3>
<p><code>git remote add origin git@git.acwing.com:xxx/XXX.git :</code> 将本地仓库关联到远程仓库</p>
<p><code>git push -u (第一次需要-u以后不需要) : </code>将当前分支推送到远程仓库</p>
<p><code>git push origin branch_name :</code> 将本地的 某个分支 推送到远程仓库</p>
<p><code>git clone git@git.acwing.com:xxx/XXX.git :</code> 将远程仓库 XXX 下载 到当前目录下</p>
<h3 id="git-多分支管理指令">git 多分支管理指令</h3>
<p><code>git branch :</code> 查看 所有分支 和 当前所处分支</p>
<p><code>git branch branch_name :</code> 创建 新分支</p>
<p><code>git checkout -b branch_name :</code> 创建并切换 到 branch_name 这个分支</p>
<p><code>git checkout branch_name :</code> 切换 到 branch_name 这个分支</p>
<p><code>git merge branch_name :</code> 将分支 branch_name 合并 到 当前分支 上</p>
<h3 id="git-多分支与远程仓库交互的指令">git 多分支与远程仓库交互的指令</h3>
<p><code>git branch -d branch_name :</code> 删除 本地仓库 的 branch_name 分支</p>
<p><code>git push -d origin branch_name :</code> 删除 远程仓库 的 branch_name 分支</p>
<p><code>git push --set-upstream origin branch_name :</code> 设置 本地仓库 的 branch_name 分支与 远程仓库 的 branch_name 分支 对应</p>
<p><code>git branch --set-upstream-to=origin/branch_name1 branch_name2 : </code>将 远程仓库 的 branch_name1 分支与 本地仓库 的 branch_name2 分支 对应</p>
<p><code>git pull :</code> 将 远程仓库 的 当前分支 与 本地仓库 的 当前分支 合并</p>
<p><code>git pull origin branch_name :</code> 将 远程仓库 的 branch_name 分支与 本地仓库 的当前分支 合并</p>
<p><code>git checkout -t origin/branch_name :</code> 将 远程仓库 的 branch_name 分支拉取到 本地仓库</p>
<h3 id="git-stash暂存">git stash暂存</h3>
<p><code>git stash :</code> 将 工作区 和 暂存区 中 尚未提交 的修改存入 栈 中</p>
<p><code>git stash apply :</code> 将 栈顶 存储的修改 恢复 到 当前分支 ，但 不删除 栈顶元素</p>
<p><code>git stash drop : </code>删除 栈顶 存储的修改</p>
<p><code>git stash pop :</code> 将 栈顶 存储的修改 恢复 到当前分支，同时删除 栈顶元素</p>
<p><code>git stash list :</code> 查看 栈中 所有元素</p>
<h3 id="作业-5">作业</h3>
<p>注意： 本次作业的10个题目不是独立的，每个题目会依赖于前一个题目，因此评测时如果当前题目错误，则不再评测后续题目。</p>
<p>创建好作业后，先进入文件夹/home/acs/homework/lesson_5/，然后：</p>
<p>(0) 在当前目录下创建文件夹homework，并将homework目录配置成git仓库。后续作业均在homework目录下操作；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SSH">mkdir homework<br>cd homework<br>git init<br></code></pre></td></tr></table></figure>
<p>(1) 创建文件readme.txt，内容包含一行：111；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vim readme.txt<br>***<br>111<br>***<br>git add .<br>git commit -m &quot;add readme.txt&quot;<br></code></pre></td></tr></table></figure>
<p>将修改提交一个commit；<br>
(2) 在readme.txt文件末尾新增一行：222；<br>
将修改提交一个commit；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vim readme.txt<br>***<br>111<br>222<br>***<br>git add .<br>git commit -m &quot;add 222&quot;<br></code></pre></td></tr></table></figure>
<p>(3) 创建文件夹：problem1和problem2；<br>
创建文件problem1/main.cpp。文件内容为下述链接中的代码：<a target="_blank" rel="noopener" href="https://www.acwing.com/problem/content/submission/code_detail/7834813/%EF%BC%9B">https://www.acwing.com/problem/content/submission/code_detail/7834813/；</a><br>
创建文件problem2/main.cpp。文件内容为下述链接中的代码：<a target="_blank" rel="noopener" href="https://www.acwing.com/problem/content/submission/code_detail/7834819/%EF%BC%9B">https://www.acwing.com/problem/content/submission/code_detail/7834819/；</a><br>
将修改提交一个commit；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mkdir problem1 problem2<br>cd problem1<br>vim main.cpp<br>***<br>#include &lt;iostream&gt;<br><br>using namespace std;<br><br>int main()<br>&#123;<br>    int a, b;<br>    cin &gt;&gt; a &gt;&gt; b;<br>    cout &lt;&lt; a + b &lt;&lt; endl;<br>    return 0;<br>&#125;<br>***<br>cd ../problem2<br>vim main.cpp<br>***<br>#include &lt;iostream&gt;<br><br>using namespace std;<br><br>const int N = 1010;<br><br>int n, m;<br>int f[N];<br><br>int main()<br>&#123;<br>    cin &gt;&gt; n &gt;&gt; m;<br>    while (n -- )<br>    &#123;<br>        int v, w;<br>        cin &gt;&gt; v &gt;&gt; w;<br>        for (int j = m; j &gt;= v; j -- )<br>            f[j] = max(f[j], f[j - v] + w);<br>    &#125;<br><br>    cout &lt;&lt; f[m] &lt;&lt; endl;<br><br>    return 0;<br>&#125;<br>***<br>cd ..<br>git add .<br>git commit -m &quot;add problem1 problem2&quot;<br></code></pre></td></tr></table></figure>
<p>(4) 删除文件夹problem2；<br>
创建文件夹problem3；<br>
创建文件problem3/main.cpp。文件内容为下述链接中的代码：<a target="_blank" rel="noopener" href="https://www.acwing.com/problem/content/submission/code_detail/7834841/%EF%BC%9B">https://www.acwing.com/problem/content/submission/code_detail/7834841/；</a><br>
将readme.txt中最后一行222删掉，然后添加一行333；<br>
将修改提交一个commit；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">rm problem2 -r<br>mkdir problem3<br>cd problem3<br>vim main.cpp<br>***<br>#include &lt;iostream&gt;<br><br>using namespace std;<br><br>const int N = 1010;<br><br>int n, m;<br>int f[N];<br><br>int main()<br>&#123;<br>    cin &gt;&gt; n &gt;&gt; m;<br><br>    while (n -- )<br>    &#123;<br>        int v, w;<br>        cin &gt;&gt; v &gt;&gt; w;<br>        for (int j = v; j &lt;= m; j ++ )<br>            f[j] = max(f[j], f[j - v] + w);<br>    &#125;<br><br>    cout &lt;&lt; f[m] &lt;&lt; endl;<br>    return 0;<br>&#125;<br>***<br><br>cd ..<br>vim readme.txt<br>***<br>111<br>333<br>***<br><br>git add .<br>git commit -m &quot;many operations&quot;<br></code></pre></td></tr></table></figure>
<p>(5) 在https://git.acwing.com/上注册账号并创建仓库，仓库名称为homework；<br>
将本地git仓库上传到AC Git云端仓库；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">本地操作<br><br>git remote add origin git@git.acwing.com:yxc/homework.git<br>git push -u origin master<br></code></pre></td></tr></table></figure>
<p>(6) 创建并切换至新分支dev；<br>
在readme.txt文件中添加一行444；<br>
将修改提交一个commit；<br>
将dev分支推送至AC Git远程仓库；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">git checkout -b dev<br>vim readme.txt<br>***<br>111<br>333<br>444<br>***<br><br>git add .<br>git commit -m &quot;add 444&quot;<br><br>git push origin dev<br></code></pre></td></tr></table></figure>
<p>(7) 切换回master分支；<br>
在readme.txt文件中添加一行555；<br>
将修改提交一个commit；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">git checkout master  # 切换回master分支<br><br>vim readme.txt<br><br>***<br>111<br>333<br>555<br>***<br><br>git add .<br>git commit -m &quot;add 555&quot;<br></code></pre></td></tr></table></figure>
<p>(8) 将dev分支合并到master分支；<br>
手动处理冲突，使readme文件最终内容包含4行：111、333、555、444；<br>
将修改提交一个commit；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">git merge dev  # 将dev分支合并到当前分支<br><br>vim readme.txt<br><br>***<br>111<br>333<br>555<br>444<br>***<br><br>git add .<br>git commit -m &quot;fix conflicts&quot;<br></code></pre></td></tr></table></figure>
<p>(9) 将master分支的版本库push到AC Git云端仓库；<br>
登录myserver服务器（4. ssh作业中配置的服务器）；<br>
创建并清空文件夹：~/homework/lesson_5/；<br>
将AC Git云端仓库clone到~/homework/lesson_5/中；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ssh myserver<br>cd homework<br>mkdir lesson_5<br>cd lesson_5<br><br>git clone git@git.acwing.com:xiaochaomeng/homework.git<br></code></pre></td></tr></table></figure>
<h2 id="thrift">thrift</h2>
<p>thrift 是一种接口描述语言和二进制通讯协议，它被用来定义和创建跨语言的服务。</p>
<p>它被当作一个远程过程调用（RPC）框架来使用，是由Facebook为“大规模跨语言服务开发”而开发的。</p>
<h3 id="查阅thrift官方文档">查阅thrift官方文档</h3>
<p><a target="_blank" rel="noopener" href="https://thrift.apache.org/">thrift 官网</a> -&gt; <a target="_blank" rel="noopener" href="https://thrift.apache.org/tutorial/">Tutorial</a> -&gt; <a target="_blank" rel="noopener" href="https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob_plain;f=tutorial/tutorial.thrift">tutorial.thrift</a></p>
<p><strong>thrift基础数据类型</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">//The first thing to know about are types. The available types in Thrift are:<br>bool        //Boolean, one byte<br>i8 (byte)   //Signed 8-bit integer<br>i16         //Signed 16-bit integer<br>i32         //Signed 32-bit integer<br>i64         //Signed 64-bit integer<br>double      //64-bit floating point value<br>string      //String<br>binary      //Blob (byte array)<br>map&lt;t1,t2&gt;  //Map from one type to another<br>list&lt;t1&gt;    //Ordered list of one type<br>set&lt;t1&gt;     //Set of unique elements of one type<br></code></pre></td></tr></table></figure>
<p><strong>声明要转化的语言</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Thrift files can namespace, package, or prefix their output in various</span><br><span class="hljs-comment"> * target languages.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">namespace</span> cl tutorial<br><span class="hljs-keyword">namespace</span> cpp tutorial<br><span class="hljs-keyword">namespace</span> d tutorial<br><span class="hljs-keyword">namespace</span> dart tutorial<br><span class="hljs-keyword">namespace</span> java tutorial<br><span class="hljs-keyword">namespace</span> php tutorial<br><span class="hljs-keyword">namespace</span> perl tutorial<br><span class="hljs-keyword">namespace</span> haxe tutorial<br><span class="hljs-keyword">namespace</span> netstd tutorial<br><br></code></pre></td></tr></table></figure>
<p><strong>结构体定义</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Structs are the basic complex data structures. They are comprised of fields</span><br><span class="hljs-comment"> * which each have an integer identifier, a type, a symbolic name, and an</span><br><span class="hljs-comment"> * optional default value.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Fields can be declared &quot;optional&quot;, which ensures they will not be included</span><br><span class="hljs-comment"> * in the serialized output if they aren&#x27;t set.  Note that this requires some</span><br><span class="hljs-comment"> * manual management in some languages.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Work</span> &#123;<br>  <span class="hljs-number">1</span>: i32 num1 = <span class="hljs-number">0</span>,<br>  <span class="hljs-number">2</span>: i32 num2,<br>  <span class="hljs-number">3</span>: Operation op,<br>  <span class="hljs-number">4</span>: optional string comment,<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>Service定义</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ahh, now onto the cool part, defining a service. Services just need a name</span><br><span class="hljs-comment"> * and can optionally inherit from another service using the extends keyword.</span><br><span class="hljs-comment"> */</span><br>service Calculator extends shared.SharedService &#123;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * A method definition looks like C code. It has a return type, arguments,</span><br><span class="hljs-comment">   * and optionally a list of exceptions that it may throw. Note that argument</span><br><span class="hljs-comment">   * lists and exception lists are specified using the exact same syntax as</span><br><span class="hljs-comment">   * field lists in struct or exception definitions.</span><br><span class="hljs-comment">   */</span><br><br>   <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ping</span><span class="hljs-params">()</span>,</span><br><span class="hljs-function"></span><br><span class="hljs-function">   i32 <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-number">1</span>:i32 num1, <span class="hljs-number">2</span>:i32 num2)</span>,</span><br><span class="hljs-function"></span><br><span class="hljs-function">   i32 <span class="hljs-title">calculate</span><span class="hljs-params">(<span class="hljs-number">1</span>:i32 logid, <span class="hljs-number">2</span>:Work w)</span> <span class="hljs-title">throws</span> <span class="hljs-params">(<span class="hljs-number">1</span>:InvalidOperation ouch)</span>,</span><br><span class="hljs-function"></span><br><span class="hljs-function">   <span class="hljs-comment">/**</span></span><br><span class="hljs-comment"><span class="hljs-function">    * This method has a oneway modifier. That means the client only makes</span></span><br><span class="hljs-comment"><span class="hljs-function">    * a request and does not listen for any response at all. Oneway methods</span></span><br><span class="hljs-comment"><span class="hljs-function">    * must be void.</span></span><br><span class="hljs-comment"><span class="hljs-function">    */</span></span><br><span class="hljs-function">   oneway <span class="hljs-type">void</span> <span class="hljs-title">zip</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="用-thrift-实现一个基本的匹配系统-接口">用 thrift 实现一个基本的匹配系统 接口</h3>
<blockquote>
<p>thrift 是一种接口描述语言，用简便的 thrift 语言写完以后，可以用命令快速生成任何语言的文件</p>
</blockquote>
<p><strong>基本框架</strong></p>
<ol>
<li>游戏应用端（Python3）
<ol>
<li>客户端：与 匹配系统服务器 的服务端交互</li>
</ol>
</li>
<li>匹配系统服务器（C++）
<ol>
<li>服务端：与 游戏应用端 的客户端交互</li>
<li>客户端：与 数据存储服务器 的服务端交互</li>
</ol>
</li>
<li>数据存储服务器（已经实现）
<ol>
<li>服务端：与 匹配系统服务器 的客户端交互<br>
<strong>初始化 git 仓库</strong></li>
</ol>
</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">mkdir</span> thrift_lesson<br><span class="hljs-built_in">cd</span> thrift_lesson<br>git init<br><br><span class="hljs-built_in">mkdir</span> thrift        <span class="hljs-comment"># 存放 thrift 源文件</span><br><span class="hljs-built_in">mkdir</span> game          <span class="hljs-comment"># 实现 游戏应用端 的 客户端 功能</span><br><span class="hljs-built_in">mkdir</span> match_system  <span class="hljs-comment"># 实现 匹配系统服务器 的 服务端 和 客户端 功能</span><br><br><span class="hljs-built_in">touch</span> readme.md<br><span class="hljs-comment"># 远程创建好git上的repo</span><br>git remote add origin git@git.acwing.com:colopen/thrift_lesson.git<br>git add .<br>git commit -m <span class="hljs-string">&quot;init repo&quot;</span><br>git push -u origin master<br></code></pre></td></tr></table></figure>
<h3 id="实现-游戏应用端-与-匹配系统服务器-的交互">实现 游戏应用端 与 匹配系统服务器 的交互</h3>
<p>创建 <strong>match.thrift</strong> 接口文件</p>
<p>用于实现 游戏应用端 与 匹配系统服务器 交互的 service</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">namespace</span> cpp match_service <span class="hljs-comment">//声明转换为C++语言</span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">User</span> &#123;   <span class="hljs-comment">//定义结构体 User</span><br>    <span class="hljs-number">1</span>: i32 id, <br>    <span class="hljs-number">2</span>: string name,<br>    <span class="hljs-number">3</span>: i32 score<br>&#125;<br><br>service Match &#123; <span class="hljs-comment">//定义service服务</span><br>    <span class="hljs-comment">/** </span><br><span class="hljs-comment">     * user: 添加的用户信息</span><br><span class="hljs-comment">     * info: 附加信息</span><br><span class="hljs-comment">     * 在匹配池中添加一个名用户</span><br><span class="hljs-comment">     */</span>  <br><br>    <span class="hljs-function">i32 <span class="hljs-title">add_user</span><span class="hljs-params">(<span class="hljs-number">1</span>: User user, <span class="hljs-number">2</span>: string info)</span>,</span><br><span class="hljs-function"></span><br><span class="hljs-function">    <span class="hljs-comment">/** </span></span><br><span class="hljs-comment"><span class="hljs-function">     * user: 删除的用户信息</span></span><br><span class="hljs-comment"><span class="hljs-function">     * info: 附加信息</span></span><br><span class="hljs-comment"><span class="hljs-function">     * 从匹配池中删除一名用户</span></span><br><span class="hljs-comment"><span class="hljs-function">     */</span>  </span><br><span class="hljs-function"></span><br><span class="hljs-function">    i32 <span class="hljs-title">remove_user</span><span class="hljs-params">(<span class="hljs-number">1</span>: User user, <span class="hljs-number">2</span>: string info)</span>,</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure>
<h4 id="匹配系统服务器的客户端">匹配系统服务器的客户端</h4>
<p><strong>运行 match.thrift 接口文件在匹配系统服务器端生成 C++ 源文件</strong></p>
<p>进入 match_system 中新建文件夹 src （之后所有的 匹配服务器 源文件放在 src 下）</p>
<p>并在 src 文件夹中运行 thrift 脚本生成 C++ 版本的文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-comment"># 原始的thrift生成文件语法：thrift -r --gen &lt;language&gt; &lt;Thrift filename&gt;</span><br><span class="hljs-built_in">mkdir</span> match_system/src<br><span class="hljs-built_in">cd</span> match_system/src<br>thrift -r --gen cpp ../../thrift/match.thrift<br><br><span class="hljs-comment"># 将该文件夹重命名为 match_server（区别于之后要此处生成的client server）</span><br><span class="hljs-comment"># match_server 与 游戏应用端交互 ; client_server 与 数据存储服务器交互</span><br><span class="hljs-built_in">mv</span> gen-cpp match_server<br><br><span class="hljs-comment"># 把 Match_server.skeleton.cpp 移动到当前 src 目录下并重命名为 main.cpp</span><br><span class="hljs-comment"># 方便之后调试 main.cpp 文件，其他的源文件仍被存放在 src 文件夹下</span><br><span class="hljs-built_in">mv</span> match_server/Match_server.skeleton.cpp main.cpp<br><br><span class="hljs-comment"># 由于移动了 main.cpp 故需要修改一下 main.cpp 中头文件里关于 Math.cpp 的引用路径</span><br><span class="hljs-comment"># 之后写 client_server 同理</span><br></code></pre></td></tr></table></figure>
<p>生成完成后的工作区状态如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs SH">acs@7854cf6acd7f:~/thrift_lesson$ tree<br>.<br>|-- game<br>|-- match_system<br>|   `-- src<br>|       |--main.cpp<br>|       `-- match_server<br>|           |-- Match.cpp<br>|           |-- Match.h<br>|           |-- match_types.cpp<br>|           `-- match_types.h<br>|-- readme.md<br>`-- thrift<br>    `-- match.thrift<br><br>5 directories, 7 files<br></code></pre></td></tr></table></figure>
<p>编译并运行 cpp 文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-comment"># 1. 编译 所有的 .cpp 文件生成 .o 文件</span><br><span class="hljs-comment"># g++ -c [文件1.cpp] [文件2.cpp] ...</span><br>g++ -c main.cpp match_server/*.cpp<br><br><span class="hljs-comment"># 2. 链接 所有的 .o 文件生成可执行文件 .exe</span><br><span class="hljs-comment"># g++ [文件1.o] [文件2.o] ... -o [需要额外添加的动态库]</span><br><span class="hljs-comment"># 此处需要额外添加 -lthrift 的 thrift 动态库</span><br>g++ *.o -o main -lthrift<br><br><span class="hljs-comment"># 3. 运行 可执行文件</span><br>./main<br></code></pre></td></tr></table></figure>
<p>将 <strong>非编译文件</strong> 和 <strong>非可执行文件</strong> 提交到 git 中去（好的工程习惯）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SH">git add .<br>git restore --stage *.o     <span class="hljs-comment"># .o文件是编译文件，不加入暂存区里</span><br>git restore --stage main    <span class="hljs-comment"># main是可执行文件，不加入暂存区里</span><br>git commit -m <span class="hljs-string">&quot;add match server&quot;</span><br>git push<br></code></pre></td></tr></table></figure>
<h4 id="游戏应用端的客户端">游戏应用端的客户端</h4>
<p>运行 match.thrift 在游戏应用端生成 python3 源文件</p>
<p>同上，在 game 文件夹下实现 游戏应用端 的 客户端</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-comment"># 原始的thrift生成文件语法：thrift -r --gen &lt;language&gt; &lt;Thrift filename&gt;</span><br><span class="hljs-built_in">mkdir</span> game/src<br><span class="hljs-built_in">cd</span> game/src<br>thrift -r --gen py ../../thrift/match.thrift<br><br><span class="hljs-comment"># 将该文件夹重命名为 match_client</span><br><span class="hljs-comment"># 不过这里不改也无所谓，游戏应用端只有匹配的客户端</span><br><span class="hljs-built_in">mv</span> gen-py match_client<br><br><span class="hljs-comment"># 删掉 Match_remote </span><br><span class="hljs-comment"># 该文件是用 py 实现 服务端 时用的文件</span><br><span class="hljs-comment"># 此处我们只需要实现 客户端 功能，因此他没有作用，不妨删掉，让文档简洁一点</span><br><span class="hljs-built_in">rm</span> match_client/match/Match-remote<br></code></pre></td></tr></table></figure>
<p>利用官网提供的模板，编写 客户端 文件 <code>client.py</code></p>
<p><a target="_blank" rel="noopener" href="https://thrift.apache.org/tutorial/py.html">官网模板</a></p>
<p><code>client.py</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># 先删去开头三行声明</span><br><span class="hljs-comment"># 此处修改路径，以及Calculator 为 Match</span><br><span class="hljs-comment"># 此处修改 ttypes 路径 以及 User 类</span><br><span class="hljs-keyword">from</span> match_client.match <span class="hljs-keyword">import</span> Match<br><span class="hljs-keyword">from</span> match_client.match.ttypes <span class="hljs-keyword">import</span> User<br><br><span class="hljs-keyword">from</span> thrift <span class="hljs-keyword">import</span> Thrift<br><span class="hljs-keyword">from</span> thrift.transport <span class="hljs-keyword">import</span> TSocket<br><span class="hljs-keyword">from</span> thrift.transport <span class="hljs-keyword">import</span> TTransport<br><span class="hljs-keyword">from</span> thrift.protocol <span class="hljs-keyword">import</span> TBinaryProtocol<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># Make socket</span><br>    transport = TSocket.TSocket(<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-number">9090</span>)<br><br>    <span class="hljs-comment"># Buffering is critical. Raw sockets are very slow</span><br>    transport = TTransport.TBufferedTransport(transport)<br><br>    <span class="hljs-comment"># Wrap in a protocol</span><br>    protocol = TBinaryProtocol.TBinaryProtocol(transport)<br><br>    <span class="hljs-comment"># Create a client to use the protocol encoder</span><br>    client = Match.Client(protocol)<br><br>    <span class="hljs-comment"># Connect!</span><br>    transport.<span class="hljs-built_in">open</span>()<br><br>    <span class="hljs-comment"># 调试语句</span><br>    user = User(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;yxc&#x27;</span>, <span class="hljs-number">1500</span>)<br>    client.add_user(user, <span class="hljs-string">&quot;&quot;</span>) <br><br>    <span class="hljs-comment"># Close!</span><br>    transport.close()<br><br><span class="hljs-comment"># 调用 main 函数</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main() <br></code></pre></td></tr></table></figure>
<p>将 非编译文件 和 非可执行文件 提交到 git 中去（好的工程习惯）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH">git add .<br>git restore --stage *.pyc   <span class="hljs-comment"># .pyc文件是编译文件，不加入暂存区里</span><br>git restore --stage *.swp   <span class="hljs-comment"># .swp文件是缓存文件，不加入暂存区里（vim没关时会生成）</span><br>git commit -m <span class="hljs-string">&quot;add client&quot;</span><br>git push<br>重写 client.py 使之能不断从终端里读入信息<br></code></pre></td></tr></table></figure>
<p><code>client.py</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># 利用 python 在终端读入信息需要引入 stdin</span><br><span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> stdin<br><br><span class="hljs-comment"># 将原来的通信 main 函数改写成operate函数，每次需要的时候调用一次建立通信传递信息</span><br><span class="hljs-comment"># 目的是可以一直不断处理信息</span><br><span class="hljs-comment"># 然后重写 main 函数，使之能不断从终端读入信息</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">operate</span>(<span class="hljs-params">op, user_id, user_name, score</span>):<br>    <span class="hljs-comment"># ...........................</span><br><br>    <span class="hljs-comment"># 针对 op 参数，分别进行 &quot;增加&quot; 与 &quot;删出&quot; 操作</span><br>    user = User(user_id, user_name, score)<br><br>    <span class="hljs-keyword">if</span> op == <span class="hljs-string">&quot;add&quot;</span>:<br>        client.add_user(user, <span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        client.remove_user(user, <span class="hljs-string">&quot;&quot;</span>)<br><br>    <span class="hljs-comment"># ...........................</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> stdin:<br>        op, user_id, user_name, score = line.split(<span class="hljs-string">&#x27; &#x27;</span>)<br>        operate(op, <span class="hljs-built_in">int</span>(user_id), user_name, <span class="hljs-built_in">int</span>(score))<br></code></pre></td></tr></table></figure>
<h4 id="在匹配服务器里给-匹配系统-开一个-线程">在匹配服务器里给 匹配系统 开一个 线程</h4>
<p>运用到了 <strong>操作系统</strong> 里的 <strong>PV</strong> 原语 以及 <strong>生产者-消费者</strong> 模型</p>
<p>重写 <code>match_system/main.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">// This autogenerated skeleton file illustrates how to build a server.</span><br><span class="hljs-comment">// You should copy it to another filename to avoid overwriting it.</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;match_server/Match.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thrift/protocol/TBinaryProtocol.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thrift/server/TSimpleServer.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thrift/transport/TServerSocket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thrift/transport/TBufferTransports.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span>               <span class="hljs-comment">// 需要线程，引入头文件</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span>                <span class="hljs-comment">// 互斥信号量</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;condition_variable&gt;</span>   <span class="hljs-comment">// 条件变量，用于 阻塞和唤醒 线程</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span>                <span class="hljs-comment">// 用于模拟消息队列</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> ::apache::thrift;<br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> ::apache::thrift::protocol;<br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> ::apache::thrift::transport;<br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> ::apache::thrift::server;<br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span>  ::match_service;<br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Task</span> <span class="hljs-comment">//消息队列中的元素</span><br>&#123;<br>    User user;<br>    string type;<br>&#125;;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MessageQueue</span> <span class="hljs-comment">//消息队列</span><br>&#123;<br>    queue&lt;Task&gt; q;          <span class="hljs-comment">//消息队列本体</span><br>    mutex m;                <span class="hljs-comment">//互斥信号量</span><br>    condition_variable cv;  <span class="hljs-comment">//条件变量，用于阻塞唤醒线程</span><br>&#125;message_queue;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Pool</span>  <span class="hljs-comment">// 模拟匹配池</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">save_result</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span>  <span class="hljs-comment">// 记录成功匹配的信息</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Match Result: %d %d\n&quot;</span>, a, b);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">match</span><span class="hljs-params">()</span>    <span class="hljs-comment">// 匹配池中的第一、第二个用户进行匹配</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">while</span> (users.<span class="hljs-built_in">size</span>() &gt; <span class="hljs-number">1</span>)<br>        &#123;<br>            <span class="hljs-keyword">auto</span> a = users[<span class="hljs-number">0</span>], b = users[<span class="hljs-number">1</span>];<br>            users.<span class="hljs-built_in">erase</span>(users.<span class="hljs-built_in">begin</span>());<br>            users.<span class="hljs-built_in">erase</span>(users.<span class="hljs-built_in">begin</span>());<br><br>            <span class="hljs-built_in">save_result</span>(a.id, b.id);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(User user)</span> <span class="hljs-comment">// 向匹配池中加入用户</span></span><br><span class="hljs-function">    </span>&#123;<br>        users.<span class="hljs-built_in">push_back</span>(user);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(User user)</span>  <span class="hljs-comment">// 从匹配池中删除用户</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> i = <span class="hljs-number">0</span>; i &lt; users.<span class="hljs-built_in">size</span>(); i ++ )<br>        &#123;<br>            <span class="hljs-keyword">if</span> (users[i].id == user.id)<br>            &#123;<br>                users.<span class="hljs-built_in">erase</span>(users.<span class="hljs-built_in">begin</span>() + i);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>    vector&lt;User&gt; users; <span class="hljs-comment">// 匹配池中的用户，用 vector 记录</span><br>&#125;pool;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MatchHandler</span> : <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">public</span> MatchIf &#123;<br>    <span class="hljs-keyword">public</span>:<br>        <span class="hljs-built_in">MatchHandler</span>() &#123;<br>            <span class="hljs-comment">// Your initialization goes here</span><br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">add_user</span><span class="hljs-params">(<span class="hljs-type">const</span> User&amp; user, <span class="hljs-type">const</span> std::string&amp; info)</span> </span>&#123;<br>            <span class="hljs-comment">// Your implementation goes here</span><br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;add_user\n&quot;</span>);<br><br>            <span class="hljs-function">unique_lock&lt;mutex&gt; <span class="hljs-title">lck</span><span class="hljs-params">(message_queue.m)</span></span>;    <span class="hljs-comment">// 访问临界区(消息队列)，先上锁</span><br>            message_queue.q.<span class="hljs-built_in">push</span>(&#123;user, <span class="hljs-string">&quot;add&quot;</span>&#125;);        <span class="hljs-comment">// 把新消息加入消息队列</span><br>            message_queue.cv.<span class="hljs-built_in">notify_all</span>();              <span class="hljs-comment">// 唤醒阻塞的线程</span><br><br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">remove_user</span><span class="hljs-params">(<span class="hljs-type">const</span> User&amp; user, <span class="hljs-type">const</span> std::string&amp; info)</span> </span>&#123;<br>            <span class="hljs-comment">// Your implementation goes here</span><br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;remove_user\n&quot;</span>);<br><br>            <span class="hljs-function">unique_lock&lt;mutex&gt; <span class="hljs-title">lck</span><span class="hljs-params">(message_queue.m)</span></span>;    <span class="hljs-comment">// 访问临界区(消息队列)，先上锁</span><br>            message_queue.q.<span class="hljs-built_in">push</span>(&#123;user, <span class="hljs-string">&quot;remove&quot;</span>&#125;);     <span class="hljs-comment">// 把新消息加入消息队列</span><br>            message_queue.cv.<span class="hljs-built_in">notify_all</span>();              <span class="hljs-comment">// 唤醒阻塞的线程</span><br><br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br><br>&#125;;<br><br><br><span class="hljs-comment">// 基于 &quot;生产者-消费者模型&quot; 的线程</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">consume_task</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>    &#123;<br>        <span class="hljs-function">unique_lock&lt;mutex&gt; <span class="hljs-title">lck</span><span class="hljs-params">(message_queue.m)</span></span>;    <span class="hljs-comment">// 访问临界区(消息队列)，先上锁</span><br><br>        <span class="hljs-keyword">if</span> (message_queue.q.<span class="hljs-built_in">empty</span>())<br>        &#123;<br>            message_queue.cv.<span class="hljs-built_in">wait</span>(lck);     <span class="hljs-comment">//这里要阻塞进程</span><br>            <span class="hljs-comment">// 避免队列为空时，一直反复运行该线程，导致一直占用临界区，而不能加入新消息</span><br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">auto</span> task = message_queue.q.<span class="hljs-built_in">front</span>();    <span class="hljs-comment">// 取出消息队列队头元素</span><br>            message_queue.q.<span class="hljs-built_in">pop</span>();<br><br>            lck.<span class="hljs-built_in">unlock</span>();   <span class="hljs-comment">// 临界区访问结束，直接解锁</span><br>            <span class="hljs-comment">// 避免后续没用到临界区信息，而长时间占用临界区的情况发生</span><br><br>            <span class="hljs-keyword">if</span> (task.type == <span class="hljs-string">&quot;add&quot;</span>) pool.<span class="hljs-built_in">add</span>(task.user);<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (task.type == <span class="hljs-string">&quot;remove&quot;</span>) pool.<span class="hljs-built_in">remove</span>(task.user);<br><br>            pool.<span class="hljs-built_in">match</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span> </span>&#123;<br>    <span class="hljs-type">int</span> port = <span class="hljs-number">9090</span>;<br>    ::<span class="hljs-function">std::shared_ptr&lt;MatchHandler&gt; <span class="hljs-title">handler</span><span class="hljs-params">(<span class="hljs-keyword">new</span> MatchHandler())</span></span>;<br>    ::<span class="hljs-function">std::shared_ptr&lt;TProcessor&gt; <span class="hljs-title">processor</span><span class="hljs-params">(<span class="hljs-keyword">new</span> MatchProcessor(handler))</span></span>;<br>    ::<span class="hljs-function">std::shared_ptr&lt;TServerTransport&gt; <span class="hljs-title">serverTransport</span><span class="hljs-params">(<span class="hljs-keyword">new</span> TServerSocket(port))</span></span>;<br>    ::<span class="hljs-function">std::shared_ptr&lt;TTransportFactory&gt; <span class="hljs-title">transportFactory</span><span class="hljs-params">(<span class="hljs-keyword">new</span> TBufferedTransportFactory())</span></span>;<br>    ::<span class="hljs-function">std::shared_ptr&lt;TProtocolFactory&gt; <span class="hljs-title">protocolFactory</span><span class="hljs-params">(<span class="hljs-keyword">new</span> TBinaryProtocolFactory())</span></span>;<br><br>    <span class="hljs-function">TSimpleServer <span class="hljs-title">server</span><span class="hljs-params">(processor, serverTransport, transportFactory, protocolFactory)</span></span>;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;Start Match Server&quot;</span> &lt;&lt; endl;<br><br>    <span class="hljs-function">thread <span class="hljs-title">matching_thread</span><span class="hljs-params">(consume_task)</span></span>;   <span class="hljs-comment">// 调用一个线程运行 consume_task</span><br><br>    server.<span class="hljs-built_in">serve</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>编译，运行，上传</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH">g++ -c main.cpp<br>g++ *.o -o main -lthrift -pthread<br><br>git add main.cpp<br>git commit -m <span class="hljs-string">&quot;match-server ver:2.0&quot;</span><br>git push<br></code></pre></td></tr></table></figure>
<h4 id="数据存储服务器-与-匹配系统服务器-的交互">数据存储服务器 与 匹配系统服务器 的交互</h4>
<p><strong>数据存储服务器的服务端</strong></p>
<p><code>save.thrift</code> 文件(现成)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-keyword">namespace</span> cpp save_service<br><br>service Save &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * username: myserver的名称</span><br><span class="hljs-comment">     * password: myserver的密码的md5sum的前8位</span><br><span class="hljs-comment">     * 用户名密码验证成功会返回0，验证失败会返回1</span><br><span class="hljs-comment">     * 验证成功后，结果会被保存到myserver:homework/lesson_6/result.txt中</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">i32 <span class="hljs-title">save_data</span><span class="hljs-params">(<span class="hljs-number">1</span>: string username, <span class="hljs-number">2</span>: string password, <span class="hljs-number">3</span>: i32 player1_id, <span class="hljs-number">4</span>: i32 player2_id)</span></span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure>
<p>在 <strong>匹配系统服务器</strong> 利用 <strong>thrift</strong> 生成 <strong>C++</strong> 文件</p>
<p>并删掉不必要 <strong>服务端</strong> 文件，因为在该交互功能里，<strong>匹配系统服务器</strong> 是作为客户端的</p>
<blockquote>
<p>而且，一个服务器里只能有一个 main 函数执行</p>
</blockquote>
<p>只保留 <strong>客户端</strong> 文件即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">cd</span> match_system/src<br>thrift -r --gen cpp ../../thrift/save.thrift<br><span class="hljs-built_in">mv</span> gen-cpp save_client<br><span class="hljs-built_in">rm</span> save_client/Save_server.skeleton.cpp<br></code></pre></td></tr></table></figure>
<p>利用 md5 哈希函数获得服务器密码的 哈希值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs SH">homework 4 getinfo<br><br>--------------<br>User: acs_2<br>HostName: 123.57.47.211<br>Password: dff1704d<br>--------------<br><br><span class="hljs-built_in">md5sum</span><br><br>dff1704d [&lt;Enter&gt;]<br>[Ctrl + D]<br><br>--------------<br>50c0f4b28a0b353e7b20489a1fd984e7  -<br>--------------<br><span class="hljs-comment"># 哈希值前 8 位就是我们要调用服务器接口时用的密码</span><br></code></pre></td></tr></table></figure>
<p>从 thrift官网 复制 Client 端的模板到 main.cpp 下与 数据存储服务器 交互的函数中，然后开始修改模板里的一些参数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">// 需要额外引入的头文件</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thrift/transport/TSocket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thrift/transport/TTransportUtils.h&gt;</span></span><br><br><span class="hljs-comment">// 需要额外声明的命名空间</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span>  ::save_service;<br><br><span class="hljs-comment">//重写 save_result 内的内容，使其能够与 &quot;数据存储服务器&quot; 交互</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">save_result</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span>  <span class="hljs-comment">// 记录成功匹配的信息</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Match Result: %d %d\n&quot;</span>, a, b);<br><br>    <span class="hljs-comment">// Client端的板子</span><br>    <span class="hljs-function">std::shared_ptr&lt;TTransport&gt; <span class="hljs-title">socket</span><span class="hljs-params">(<span class="hljs-keyword">new</span> TSocket(<span class="hljs-string">&quot;123.57.47.211&quot;</span>, <span class="hljs-number">9090</span>))</span></span>;<br>    <span class="hljs-function">std::shared_ptr&lt;TTransport&gt; <span class="hljs-title">transport</span><span class="hljs-params">(<span class="hljs-keyword">new</span> TBufferedTransport(socket))</span></span>;<br>    <span class="hljs-function">std::shared_ptr&lt;TProtocol&gt; <span class="hljs-title">protocol</span><span class="hljs-params">(<span class="hljs-keyword">new</span> TBinaryProtocol(transport))</span></span>;<br>    <span class="hljs-function">SaveClient <span class="hljs-title">client</span><span class="hljs-params">(protocol)</span></span>;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        transport-&gt;<span class="hljs-built_in">open</span>();<br><br>        <span class="hljs-comment">//调用接口，把信息存储 &quot;数据存储服务器&quot; 中</span><br>        <span class="hljs-type">int</span> res = client.<span class="hljs-built_in">save_data</span>(<span class="hljs-string">&quot;acs_2&quot;</span>, <span class="hljs-string">&quot;50c0f4b2&quot;</span>, a, b);<br>        <span class="hljs-comment">//输出匹配结果</span><br>        <span class="hljs-keyword">if</span> (!res) <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;success&quot;</span>);<br>        <span class="hljs-keyword">else</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;fail&quot;</span>);<br><br>        transport-&gt;<span class="hljs-built_in">close</span>();<br>    &#125; <span class="hljs-built_in">catch</span> (TException&amp; tx) &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;ERROR: &quot;</span> &lt;&lt; tx.<span class="hljs-built_in">what</span>() &lt;&lt; endl;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>编译，运行，上传</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs SH">g++ -c main.cpp save_client/*.cpp<br>g++ *.o -o main -lthrift -pthread<br>./main<br><br>-------------<br><span class="hljs-comment"># 游戏应用端</span><br>add 1 yxc 1500<br>add 2 zxc 1500<br><span class="hljs-comment"># 匹配系统服务器</span><br>add_user<br>add_user<br>Match Result: 1 2<br>success<br><span class="hljs-comment"># 数据存储服务器</span><br><span class="hljs-comment">## homework/lesson_6/result.txt</span><br>result: 1 2<br>141da30f<br>-------------<br><br><span class="hljs-comment"># 上传到 git 服务器</span><br>git add main.cpp<br>git add ../../thrift/save.thrift<br>git commit -m <span class="hljs-string">&quot;implement save-client&quot;</span><br>git push<br></code></pre></td></tr></table></figure>
<p>实现匹配系统 ver3.0 功能：每次只匹配分差小于 50 的用户<br>
该功能的实现比较简单，基本的模拟题</p>
<p>考虑重写 main.cpp 文件中的部分函数功能</p>
<p>修改线程中 消息队列 为空时，不再是 阻塞 直到 唤醒 为止</p>
<p>让其可以每经过 1 秒就进行一次 match() 调用</p>
<p>这样做的目的是：由于我们的匹配策略发生了变化，可能匹配池中仍然有用户在等待匹配（当前匹配池各个用户分差都大于50），而消息队列此时仍为空</p>
<p>如果仍然采用先前的策略，可能会导致进程卡死（新用户不进去，老用户永远匹配不了）</p>
<blockquote>
<p>如果不加入 “随时间扩大匹配域” 的功能，无论改不改上述情况都会可能发生<br>
但是为了后续实现 “随时间扩大匹配域” 功能，先做一个铺垫</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">//引入调用 sleep 函数的头文件</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span><span class="hljs-comment">// 用于调用 sleep 函数</span></span><br><br><span class="hljs-comment">//修改 &quot;生产者 - 消费者模型&quot; 的线程中，关于消息队列为空时的处理</span><br><span class="hljs-keyword">if</span> (message_queue.q.<span class="hljs-built_in">empty</span>())<br>&#123;<br>    <span class="hljs-comment">// 此处修改为每 1 秒进行一次匹配，而不是等到被唤醒时才匹配</span><br>    lck.<span class="hljs-built_in">unlock</span>();   <span class="hljs-comment">// 直接解锁临界区资源</span><br>    pool.match;     <span class="hljs-comment">//调用math()</span><br>&#125;<br><br><span class="hljs-comment">//重写匹配池Pool类中的match函数，使之可以匹配分数差在 50 以内的两个用户</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">match</span><span class="hljs-params">()</span>    <span class="hljs-comment">// 匹配池中的第一、第二个用户进行匹配</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">while</span> (users.<span class="hljs-built_in">size</span>() &gt; <span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-comment">// 按照 rank分 排序</span><br>        <span class="hljs-built_in">sort</span>(users.<span class="hljs-built_in">begin</span>(), users.<span class="hljs-built_in">end</span>(), [&amp;](User &amp;a, User &amp;b)&#123;<br>            <span class="hljs-keyword">return</span> a.score &lt; b.score;<br>        &#125;);<br>        <span class="hljs-type">bool</span> flag = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> i = <span class="hljs-number">1</span>; i &lt; users.<span class="hljs-built_in">size</span>(); i ++ )<br>        &#123;<br>            User a = users[i - <span class="hljs-number">1</span>], b = users[i];<br>            <span class="hljs-comment">// 两名玩家分数差小于50时进行匹配</span><br>            <span class="hljs-keyword">if</span> (b.score - a.score &lt;= <span class="hljs-number">50</span>)<br>            &#123;<br>                users.<span class="hljs-built_in">erase</span>(users.<span class="hljs-built_in">begin</span>() + i - <span class="hljs-number">1</span>, users.<span class="hljs-built_in">begin</span>() + i); <span class="hljs-comment">//删掉用户a,b</span><br>                <span class="hljs-built_in">save_result</span>(a.id, b.id);<br><br>                flag = <span class="hljs-literal">false</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (flag) <span class="hljs-keyword">break</span>;    <span class="hljs-comment">// 一轮扫描后，发现没有能够匹配的用户，就停止扫描，等待下次调用</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>编译，运行，上传</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs CPP">g++ -c main.cpp<br>g++ *.o -o main -lthrift -pthread<br>./main<br><br>-------------<br># 游戏应用端<br>add <span class="hljs-number">1</span> yxc <span class="hljs-number">2000</span><br>add <span class="hljs-number">2</span> zxc <span class="hljs-number">1500</span><br>add <span class="hljs-number">3</span> cxc <span class="hljs-number">1549</span><br># 匹配系统服务器<br>add_user<br>add_user    # 此处用户 yxc 与用户 zxc 没有匹配，因为分差超过<span class="hljs-number">50</span><br>add_user<br>Match Result: <span class="hljs-number">2</span> <span class="hljs-number">3</span>   # 用户 zxc 与用户 cxc 分差在 <span class="hljs-number">50</span> 以内，进行匹配<br>success<br># 数据存储服务器<br>#<span class="hljs-meta"># homework/lesson_6/result.txt</span><br>result: <span class="hljs-number">2</span> <span class="hljs-number">3</span><br>b6281235<br>-------------<br><br># 上传到 git 服务器<br>git add main.cpp<br>git add ../../thrift/save.thrift<br>git commit -m <span class="hljs-string">&quot;match server:3.0&quot;</span><br>git push<br></code></pre></td></tr></table></figure>
<p>实现匹配系统 ver4.0 功能：多线程</p>
<p>重写 main.cpp 文件</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">// 引入新的多线程头文件</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thrift/concurrency/ThreadManager.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thrift/concurrency/ThreadFactory.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thrift/server/TThreadPoolServer.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thrift/server/TThreadedServer.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thrift/TToString.h&gt;</span></span><br><br><span class="hljs-comment">// 复制模板的类 CalculatorCloneFactory 然后改一改，把所有的 Calculator 改为 Match</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MatchCloneFactory</span> : <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">public</span> MatchIfFactory &#123;<br>    <span class="hljs-keyword">public</span>:<br>        ~<span class="hljs-built_in">MatchCloneFactory</span>() <span class="hljs-keyword">override</span> = <span class="hljs-keyword">default</span>;<br>        <span class="hljs-function">MatchIf* <span class="hljs-title">getHandler</span><span class="hljs-params">(<span class="hljs-type">const</span> ::apache::thrift::TConnectionInfo&amp; connInfo)</span> <span class="hljs-keyword">override</span></span><br><span class="hljs-function">        </span>&#123;<br>            std::shared_ptr&lt;TSocket&gt; sock = std::<span class="hljs-built_in">dynamic_pointer_cast</span>&lt;TSocket&gt;(connInfo.transport);<br>            <span class="hljs-comment">/*</span><br><span class="hljs-comment">            cout &lt;&lt; &quot;Incoming connection\n&quot;;</span><br><span class="hljs-comment">            cout &lt;&lt; &quot;\tSocketInfo: &quot;  &lt;&lt; sock-&gt;getSocketInfo() &lt;&lt; &quot;\n&quot;;</span><br><span class="hljs-comment">            cout &lt;&lt; &quot;\tPeerHost: &quot;    &lt;&lt; sock-&gt;getPeerHost() &lt;&lt; &quot;\n&quot;;</span><br><span class="hljs-comment">            cout &lt;&lt; &quot;\tPeerAddress: &quot; &lt;&lt; sock-&gt;getPeerAddress() &lt;&lt; &quot;\n&quot;;</span><br><span class="hljs-comment">            cout &lt;&lt; &quot;\tPeerPort: &quot;    &lt;&lt; sock-&gt;getPeerPort() &lt;&lt; &quot;\n&quot;;</span><br><span class="hljs-comment">            */</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MatchHandler;<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">releaseHandler</span><span class="hljs-params">(MatchIf* handler)</span> <span class="hljs-keyword">override</span> </span>&#123;    <span class="hljs-comment">//改为MatchIf*  </span><br>            <span class="hljs-keyword">delete</span> handler;<br>        &#125;<br>&#125;;<br><span class="hljs-comment">// 重写main函数，启用多线程服务器</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span> </span>&#123;<br>    <span class="hljs-function">TThreadedServer <span class="hljs-title">server</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            std::make_shared&lt;MatchProcessorFactory&gt;(std::make_shared&lt;MatchCloneFactory&gt;()),</span></span><br><span class="hljs-params"><span class="hljs-function">            std::make_shared&lt;TServerSocket&gt;(<span class="hljs-number">9090</span>), <span class="hljs-comment">//port</span></span></span><br><span class="hljs-params"><span class="hljs-function">            std::make_shared&lt;TBufferedTransportFactory&gt;(),</span></span><br><span class="hljs-params"><span class="hljs-function">            std::make_shared&lt;TBinaryProtocolFactory&gt;())</span></span>;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;Start Match Server&quot;</span> &lt;&lt; endl;<br><br>    <span class="hljs-function">thread <span class="hljs-title">matching_thread</span><span class="hljs-params">(consume_task)</span></span>;   <span class="hljs-comment">// 调用一个线程运行 consume_task</span><br><br>    server.<span class="hljs-built_in">serve</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>编译，运行，上传</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs SH">g++ -c main.cpp<br>g++ *.o -o main -lthrift -pthread<br>./main<br><span class="hljs-comment"># 上传到 git 服务器</span><br>git add main.cpp<br>git commit -m <span class="hljs-string">&quot;match server:4.0&quot;</span><br>git push<br></code></pre></td></tr></table></figure>
<p>实现匹配系统 ver5.0 功能：随时间扩大匹配域<br>
就是字面意思，模拟一下就好了</p>
<p>说一下 y总 的做法，用额外一个数组 wt 来记录每个用户的等待时间</p>
<p>因为在消息队列为空时，线程会每 1 秒调用一次 match 函数</p>
<p>然后每次调用 match 函数，会首先对 匹配池中所有用户的 wt 值自增 1</p>
<p>从而实现用 wt 记录每个用户的等待时间</p>
<p>然后，每一单位的 wt 会扩大 50分 的匹配域，从而达到模拟题意的功能</p>
<p>main.cpp 修改部分</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">// 主要修改的是 pool 类中关于 match 函数的部分</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Pool</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    ....<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">check</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span></span><br><span class="hljs-function">    </span>&#123;<br>        User a = users[i], b = users[j];<br>        <span class="hljs-type">int</span> diff = <span class="hljs-built_in">abs</span>(a.score - b.score);<br>        <span class="hljs-type">int</span> a_diff_max = wt[i] * <span class="hljs-number">50</span>; <br>        <span class="hljs-type">int</span> b_diff_max = wt[j] * <span class="hljs-number">50</span>; <br>        <span class="hljs-keyword">return</span> diff &lt;= a_diff_max &amp;&amp; diff &lt;= b_diff_max;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">match</span><span class="hljs-params">()</span>    <span class="hljs-comment">// 匹配池中的第一、第二个用户进行匹配</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// 每 1 秒调用 1 次 match，实现 wt 自增 1，从而实现使所有用户等待时间增加</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> &amp;t: wt) <br>            t ++ ;<br><br>        <span class="hljs-keyword">while</span> (users.<span class="hljs-built_in">size</span>() &gt; <span class="hljs-number">1</span>)<br>        &#123;<br>            <span class="hljs-type">bool</span> flag = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> i = <span class="hljs-number">0</span>; i &lt; users.<span class="hljs-built_in">size</span>(); i ++ )<br>            &#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> j = i + <span class="hljs-number">1</span>; j &lt; users.<span class="hljs-built_in">size</span>(); j ++ )<br>                &#123;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">check</span>(i, j)) <br>                    &#123;<br>                        users.<span class="hljs-built_in">erase</span>(users.<span class="hljs-built_in">begin</span>() + j); <br>                        users.<span class="hljs-built_in">erase</span>(users.<span class="hljs-built_in">begin</span>() + i); <br>                        wt.<span class="hljs-built_in">erase</span>(wt.<span class="hljs-built_in">begin</span>() + j); <br>                        wt.<span class="hljs-built_in">erase</span>(wt.<span class="hljs-built_in">begin</span>() + i); <br><br>                        <span class="hljs-built_in">save_result</span>(users[i].id, users[j].id);<br>                        flag = <span class="hljs-literal">false</span>;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (!flag) <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (flag) <span class="hljs-keyword">break</span>;    <span class="hljs-comment">// 一轮扫描后，发现没有能够匹配的用户，就停止扫描，等待下次调用</span><br>        &#125;<br>    &#125;<br>    ....<br><span class="hljs-keyword">private</span>:<br>    ....<br>    vector&lt;<span class="hljs-type">int</span>&gt; wt; <span class="hljs-comment">//wait_time 记录每个用户的等待时间</span><br>&#125;pool;<br></code></pre></td></tr></table></figure>
<p>编译，运行，上传</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs SH">g++ -c main.cpp<br>g++ *.o -o main -lthrift -pthread<br>./main<br><br>-------------<br><span class="hljs-comment"># 游戏应用端</span><br>add 1 yxc 2000<br>add 2 zxc 1500<br><span class="hljs-comment"># 匹配系统服务器</span><br>add_user<br>add_user<br><span class="hljs-comment"># 等待了 10 s</span><br>Match Result: 1 2<br>success<br><span class="hljs-comment"># 数据存储服务器</span><br><span class="hljs-comment">## homework/lesson_6/result.txt</span><br>result: 1 2<br>141da30f<br>-------------<br><br><span class="hljs-comment"># 上传到 git 服务器</span><br>git add main.cpp<br>git commit -m <span class="hljs-string">&quot;match server:5.0&quot;</span><br>git push<br></code></pre></td></tr></table></figure>
<h3 id="作业-6">作业</h3>
<p>本次作业为复现课上最后一个版本的内容，课程视频地址： <a target="_blank" rel="noopener" href="https://www.acwing.com/video/3479/">https://www.acwing.com/video/3479/</a><br>
注意：本次作业的2个题目采用整体评测，即如果两个作业同时正确，则得100分；否则如果至少有一个作业错误，则得0分。</p>
<p>创建好作业后，先进入文件夹 /home/acs/homework/lesson_6/ ，当前目录的文件结构如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs SH">`-- thrift_lesson<br>    |-- game<br>    |   `-- src<br>    |-- match_system<br>    |   `-- src <br>    |-- readme.md<br>    `-- thrift<br>        |-- match.thrift<br>        `-- save.thrift <br></code></pre></td></tr></table></figure>
<ol start="0">
<li>进入 thrift_lesson/match_system/src/ 目录，用cpp实现课上的match-server和save-client逻辑。</li>
</ol>
<p>接口文件在thrift_lesson/thrift/中。</p>
<p>实现后启动server，监听端口9090。</p>
<p>创建match-server：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cd thrift_lesson/match_system/src<br>thrift -r --gen cpp ../../thrift/match.thrift<br>mv gen-cpp match_server<br>rm match_server/Match_server.skeleton.cpp<br></code></pre></td></tr></table></figure>
<p>创建save-client：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cd thrift_lesson/match_system/src<br>thrift -r --gen cpp ../../thrift/save.thrift<br>mv gen-cpp save_client<br>rm save_client/Save_server.skeleton.cpp<br></code></pre></td></tr></table></figure>
<p>创建main.cpp，源代码在<a target="_blank" rel="noopener" href="https://git.acwing.com/xiaochaomeng/thrift_lesson/-/blob/master/match_system/src/main.cpp">这里</a>:</p>
<p>编译：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">g++ -c main.cpp match_server/*.cpp save_client/*.cpp<br></code></pre></td></tr></table></figure>
<p>链接：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">g++ *.o -o main -lthrift -pthread<br></code></pre></td></tr></table></figure>
<p>启动服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">./main<br></code></pre></td></tr></table></figure>
<ol>
<li>进入 thrift_lesson/game/src/ 目录，用 python3 实现课上的 match-client 逻辑。</li>
</ol>
<p>文件名和输入格式与课上内容相同。</p>
<p>创建match-client：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cd thrift_lesson/game/src<br>thrift -r --gen py ../../thrift/match.thrift<br>rm gen-py/match/Match-remote<br>mv gen-py match_client<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://xn--client-hn3jk46f.py">创建client.py</a>，内容在<a target="_blank" rel="noopener" href="https://git.acwing.com/xiaochaomeng/thrift_lesson/-/blob/master/game/src/client.py">这里</a>。</p>
<p><a target="_blank" rel="noopener" href="http://xn--client-vh7lp71w.py">执行client.py</a>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">python3 client.py<br></code></pre></td></tr></table></figure>
<h3 id="管道、环境变量与常用命令">管道、环境变量与常用命令</h3>
<h4 id="管道">管道</h4>
<p>概念</p>
<p>管道类似于文件重定向，可以将前一个命令的 <code>stdout</code> 重定向到下一个命令的 <code>stdin</code>。</p>
<p><strong>要点</strong></p>
<p>管道命令仅处理 <code>stdout</code>，会忽略 <code>stderr</code>。</p>
<p>管道右边的命令必须能接受stdin。</p>
<p>多个管道命令可以串联。</p>
<p><strong>与文件重定向的区别</strong></p>
<ul>
<li>文件重定向左边为命令，右边为文件。</li>
<li>管道左右两边均为命令，左边有 stdout，右边有 stdin。<br>
举例<br>
统计当前目录下所有 <code>python</code> 文件的总行数，其中 <code>find、xargs、wc</code> 等命令可以参考常用命令这一节内容。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">find . -name <span class="hljs-string">&#x27;*.py&#x27;</span> | xargs <span class="hljs-built_in">cat</span> | <span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure>
<h4 id="环境变量">环境变量</h4>
<p><strong>概念</strong></p>
<p>Linux 系统中会用很多环境变量来记录配置信息。</p>
<p>环境变量类似于全局变量，可以被各个进程访问到。我们可以通过修改环境变量来方便地修改系统配置。</p>
<p><strong>查看</strong></p>
<p>列出当前环境下的所有环境变量 :</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">env</span>  <span class="hljs-comment"># 显示当前用户的变量</span><br><span class="hljs-built_in">set</span>  <span class="hljs-comment"># 显示当前shell的变量，包括当前用户的变量;</span><br><span class="hljs-built_in">export</span>  <span class="hljs-comment"># 显示当前导出成用户变量的shell变量</span><br></code></pre></td></tr></table></figure>
<p>输出某个环境变量的值 :</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure>
<p><strong>修改</strong></p>
<p>环境变量的定义、修改、删除操作可以参考 shell语法——变量 这一节的内容。</p>
<p>为了将对环境变量的修改应用到未来所有环境下，可以将修改命令放到 <code>~/.bashrc</code> 文件中。</p>
<p>修改完 <code>~/.bashrc</code> 文件后，记得执行 <code>source ~/.bashrc</code>，来将修改应用到当前的 <code>bash</code> 环境下。</p>
<p>为何将修改命令放到 <code>~/.bashrc</code> ，就可以确保修改会影响未来所有的环境呢？</p>
<p>每次启动 <code>bash</code>，都会先执行 <code>~/.bashrc</code>。<br>
每次 <code>ssh</code> 登陆远程服务器，都会启动一个 <code>bash</code> 命令行给我们。<br>
每次 <code>tmux</code> 新开一个 <code>pane</code>，都会启动一个 <code>bash</code> 命令行给我们。<br>
所以未来所有新开的环境都会加载我们修改的内容。</p>
<p><strong>常见环境变量</strong></p>
<ol>
<li><code>HOME</code> : 用户的家目录</li>
<li><code>PATH</code> : 可执行文件（命令）的存储路径。路径与路径之间用:分隔。当某个可执行文件同时出现在多个路径中时，会选择从左到右数第一个路径中的执行。下列所有存储路径的环境变量，均采用从左到右的优先顺序。</li>
<li><code>LD_LIBRARY_PATH</code> : 用于指定动态链接库(.so 文件)的路径，其内容是以冒号分隔的路径列表。</li>
<li><code>C_INCLUDE_PATH</code> : C 语言的头文件路径，内容是以冒号分隔的路径列表。</li>
<li><code>CPLUS_INCLUDE_PATH</code> : CPP 的头文件路径，内容是以冒号分隔的路径列表。</li>
<li><code>PYTHONPATH</code> : Python 导入包的路径，内容是以冒号分隔的路径列表。</li>
<li><code>JAVA_HOME</code> : jdk 的安装目录。</li>
<li><code>CLASSPATH</code> : 存放 Java 导入类的路径，内容是以冒号分隔的路径列表。</li>
</ol>
<h3 id="常用命令">常用命令</h3>
<blockquote>
<p>yxc: Linux命令非常多，本节讲解几个常用命令。其他命令依赖于大家根据实际操作环境，边用边查。</p>
</blockquote>
<h4 id="系统状况">系统状况</h4>
<ol>
<li>top : 查看所有进程的信息（Linux的任务管理器）
<ul>
<li>打开后，输入 <code>M</code> : 按使用内存排序</li>
<li>打开后，输入 <code>P</code> : 按使用CPU排序</li>
<li>打开后，输入 <code>q</code> : 退出</li>
</ul>
</li>
<li><code>df -h</code> : 查看硬盘使用情况</li>
<li><code>free -h</code> :查看内存使用情况</li>
<li><code>du -sh</code> : 查看当前目录占用的硬盘空间</li>
<li><code>ps aux</code> : 查看所有进程</li>
<li><code>kill -9 pid</code> : 杀死编号为 pid 的进程
<ul>
<li>传递某个具体的信号 : kill -s SIGTERM pid</li>
</ul>
</li>
<li><code>netstat -nt</code> : 查看所有网络连接</li>
<li><code>w</code> : 列出当前登陆的用户</li>
<li><code>ping www.baidu.com</code> : 检查是否连网</li>
</ol>
<h4 id="文件权限">文件权限</h4>
<ol>
<li><code>chmod</code> : 修改文件权限
<ol>
<li><code>chmod +x xxx</code> : 给xxx添加可执行权限</li>
<li><code>chmod -x xxx</code> : 去掉xxx的可执行权限</li>
<li><code>chmod 777 xxx</code> : 将xxx的权限改成777</li>
<li><code>chmod 777 xxx -R</code> : 递归修改整个文件夹的权限</li>
</ol>
</li>
</ol>
<h4 id="文件检索">文件检索</h4>
<ol>
<li>
<p><code>find /path/to/directory/ -name '*.py'</code> : 搜索某个文件路径下的所有 *.py 文件</p>
</li>
<li>
<p><code>grep xxx</code> : 从 stdin 中读入若干行数据，如果某行中包含 xxx ，则输出该行；否则忽略该行</p>
</li>
<li>
<p><code>wc</code> : 统计行数、单词数、字节数 既可以从 stdin 中直接读入内容；也可以在命令行参数中传入文件名列表；</p>
<ol>
<li><code>wc -l</code> : 统计行数</li>
<li><code>wc -w</code> : 统计单词数</li>
<li><code>wc -c</code> : 统计字节数</li>
</ol>
</li>
<li>
<p><code>tree</code> : 展示当前目录的文件结构</p>
<ol>
<li><code>tree /path/to/directory/</code> : 展示某个目录的文件结构</li>
<li><code>tree -a</code> : 展示隐藏文件</li>
</ol>
</li>
<li>
<p><code>ag xxx :</code> 搜索当前目录下的所有文件，检索 <code>xxx</code> 字符串</p>
</li>
<li>
<p><code>cut :</code> 分割一行内容<br>
从 <code>stdin</code> 中读入多行数据</p>
<ul>
<li><code>echo $PATH | cut -d ':' -f 3,5</code> : 输出 PATH 用 : 分割后第 3、5 列数据</li>
<li><code>echo $PATH | cut -d ':' -f 3-5</code> : 输出 PATH 用 : 分割后第 3-5 列数据</li>
<li><code>echo $PATH | cut -c 3,5</code> : 输出 PATH 的第 3、5 个字符</li>
<li><code>echo $PATH | cut -c 3-5</code> : 输出 PATH 的第 3-5 个字符</li>
</ul>
</li>
<li>
<p><code>sort</code> : 将每行内容按字典序排序</p>
<ul>
<li>可以从 stdin 中读取多行数据</li>
<li>可以从命令行参数中读取文件名列表</li>
</ul>
</li>
<li>
<p><code>xargs</code> : 将 <code>stdin</code> 中的数据用空格或回车分割成命令行参数</p>
</li>
<li>
<p><code>find . -name '*.py' | xargs cat | wc -l</code> : 统计当前目录下所有 python 文件的总行数</p>
</li>
</ol>
<h4 id="查看文件内容">查看文件内容</h4>
<ol>
<li><code>more</code> : 浏览文件内容
<ul>
<li><code>回车</code> : 下一行</li>
<li><code>空格</code> : 下一页</li>
<li><code>b</code> : 上一页</li>
<li><code>q</code> : 退出</li>
</ul>
</li>
<li><code>less</code> : 与 <code>more</code> 类似，功能更全
<ul>
<li><code>回车</code> : 下一行</li>
<li><code>y</code> : 上一行</li>
<li><code>Page Down</code> : 下一页</li>
<li><code>Page Up</code> : 上一页</li>
<li><code>q</code> : 退出</li>
</ul>
</li>
<li><code>head -3 xxx</code> : 展示 xxx 的前 3 行内容
<ul>
<li>同时支持从stdin读入内容</li>
</ul>
</li>
<li><code>tail -3 xxx </code>: 展示 xxx 末尾 3 行内容
<ul>
<li>同时支持从stdin读入内容</li>
</ul>
</li>
</ol>
<h4 id="用户相关">用户相关</h4>
<ol>
<li><code>history </code>: 展示当前用户的历史操作。内容存放在 ~/.bash_history 中<br>
<strong>工具</strong></li>
<li><code>md5sum</code> : 计算 md5 哈希值
<ul>
<li>可以从stdin读入内容</li>
<li>也可以在命令行参数中传入文件名列表</li>
</ul>
</li>
<li><code>time command</code> : 统计 <code>command</code> 命令的执行时间</li>
<li><code>ipython3</code> : 交互式 <code>python3</code> 环境。可以当做计算器，或者批量管理文件。<br>
<code>! echo &quot;Hello World&quot;</code> : <code>!</code> 表示执行 <code>shell</code> 脚本</li>
<li><code>watch -n 0.1 command</code> : 每 <code>0.1</code> 秒执行一次 <code>command</code> 命令</li>
<li><code>tar</code> : 压缩文件<br>
<code>tar -zcvf xxx.tar.gz /path/to/file/* :</code> 压缩<br>
<code>tar -zxvf xxx.tar.gz :</code> 解压缩</li>
<li><code>diff xxx yyy :</code> 查找文件 <code>xxx</code> 与 <code>yyy</code> 的不同点</li>
</ol>
<h4 id="安装软件">安装软件</h4>
<ol>
<li><code>sudo command</code> : 以 <code>root</code> 身份执行 <code>command</code>命令</li>
<li><code>apt-get install xxx</code> : 安装软件（Ubuntu）<br>
<code>yum install xxx </code>: 安装软件（CentOS）</li>
<li><code>pip install xxx --user --upgrade</code> : 安装 python 包<br>
<code>pip3</code> 升级版的 <code>pip</code></li>
</ol>
<h3 id="作业-7">作业</h3>
<p>创建好作业后，先进入文件夹/home/acs/homework/lesson_7/，然后：</p>
<ul>
<li>(0) 进入homework_0文件夹，然后：<br>
[1] 编写可执行shell脚本，文件名为mydu，使得在任意目录执行该脚本后，可以输出当前目录所占用的磁盘空间大小，格式化输出（例如 1K, 234M, 2G）。<br>
[2] 修改环境变量PATH，使得在任意目录下输入mydu均可执行上述脚本。<br>
进入homework_0文件夹</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vim mydu<br><br>***<br>#! /bin/bash<br><br>du -sh<br>***<br></code></pre></td></tr></table></figure>
<p>[1] 添加可执行权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">chmod +x mydu<br></code></pre></td></tr></table></figure>
<p>[2] 在~/.bashrc文件末尾添加一行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">export PATH=/home/acs/homework/lesson_7/homework_0:$PATH<br></code></pre></td></tr></table></figure>
<p>应用该修改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">source ~/.bashrc<br></code></pre></td></tr></table></figure>
<ul>
<li>(1) 进入homework_1文件夹，然后：<br>
[1] 给当前目录下的所有文件添加可读权限。<br>
[2] 统计当前目录下共有多少个以.cpp结尾的文件，将结果写入ans.txt中。<br>
进入入homework_1文件夹；</li>
</ul>
<p>[1] 添加可读权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">chmod +r * -R<br></code></pre></td></tr></table></figure>
<p>[2] 统计行数:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">find . -name &#x27;*.cpp&#x27; | wc -l &gt; ans.txt<br></code></pre></td></tr></table></figure>
<ul>
<li>(2) 进入homework_2文件夹，然后：<br>
[1] 统计当前目录下所有cpp文件的总行数，将结果写入ans1.txt中。<br>
[2] 遍历当前目录下所有py文件，统计共有多少行包含字符串thrift，将结果写入ans2.txt中。<br>
进入homework_2文件夹。</li>
</ul>
<p>[1] 统计cpp文件总行数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">find . -name &#x27;*.cpp&#x27; | xargs cat | wc -l &gt; ans1.txt<br></code></pre></td></tr></table></figure>
<p>[2] 统计py文件包含thrift字符串的总行数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">find . -name &#x27;*.py&#x27; | xargs cat | grep thrift | wc -l &gt; ans2.txt<br></code></pre></td></tr></table></figure>
<ul>
<li>(3) 进入homework_3文件夹，然后删除当前目录下的所有py文件。<br>
进入homework_3文件夹。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">find . -name &#x27;*.py&#x27; | xargs rm<br></code></pre></td></tr></table></figure>
<ul>
<li>(4) 进入homework_4文件夹，然后：<br>
[1] 当前目录下包含一个文件scores.txt，文件中有若干行数据，每行数据包含用空格隔开的3个字段：姓名、数学成绩、算法成绩。<br>
[2] 将scores.txt文件的内容以空格为分隔符分隔成3列，将第一列内容写入names.txt，第二列内容写入mathematics.txt，第三列内容写入algorithm.txt。<br>
注意：scores.txt文件本身不要修改。<br>
进入homework_4文件夹。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cat scores.txt | cut -d &#x27; &#x27; -f 1 &gt; names.txt<br>cat scores.txt | cut -d &#x27; &#x27; -f 2 &gt; mathematics.txt<br>cat scores.txt | cut -d &#x27; &#x27; -f 3 &gt; algorithm.txt<br></code></pre></td></tr></table></figure>
<ul>
<li>(5) 进入homework_5文件夹，然后：<br>
[1] 当前目录下包含一个文件scores.txt，文件中有若干行数据，每行数据包含用空格隔开的3个字段：姓名、数学成绩、算法成绩。<br>
[2] 将scores.txt文件的内容以空格为分隔符分隔成3列，将第一列内容按字典序从小到大排序后写入names.txt。<br>
注意：scores.txt文件本身不要修改。<br>
进入homework_5文件夹。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cat scores.txt | cut -d &#x27; &#x27; -f 1 | sort &gt; names.txt<br></code></pre></td></tr></table></figure>
<ul>
<li>(6) 进入homework_6文件夹，然后将scores.txt文件的前5行写入top.txt，后4行写入bottom.txt。<br>
进入homework_6文件夹。</li>
</ul>
<p>[1] 选取前5行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">head -5 scores.txt &gt; top.txt<br></code></pre></td></tr></table></figure>
<p>[2] 选取后4行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">tail -4 scores.txt &gt; bottom.txt<br></code></pre></td></tr></table></figure>
<ul>
<li>(7) 进入homework_7文件夹，计算scores.txt文件的md5sum，将结果写入ans.txt。注意：ans.txt文件中只包含长度为32的md5sum，不包含其他内容。<br>
进入homework_7文件夹。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">md5sum scores.txt | cut -c 1-32 &gt; ans.txt<br></code></pre></td></tr></table></figure>
<ul>
<li>(8) 进入homework_8文件夹，然后：<br>
[1] 将dir_a文件夹压缩为project_a.tar.gz。<br>
[2] 将project_b.tar.gz压缩文件解压到当前目录。<br>
注意：不要删除dir_a文件夹和project_b.tar.gz文件。<br>
进入homework_8文件夹。</li>
</ul>
<p>[1] 压缩文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">tar -zcvf project_a.tar.gz dir_a/*<br></code></pre></td></tr></table></figure>
<p>[2] 解压文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">tar -zxvf project_b.tar.gz<br></code></pre></td></tr></table></figure>
<ul>
<li>(9) 进入homework_9文件夹，然后计算 2112+3782112+378，将结果写入ans.txt中。<br>
进入homework_9文件夹</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ipython3  # 打python3交互环境<br><br>res = 2**112 + 3**78<br><br>! echo $res &gt; ans.txt  # ! 表示后面的内容是shell脚本<br></code></pre></td></tr></table></figure>
<h2 id="租云服务器及安装docker">租云服务器及安装docker</h2>
<p>腾讯云 : <a target="_blank" rel="noopener" href="https://cloud.tencent.com/">https://cloud.tencent.com/</a></p>
<p>创建工作用户 acs 并赋予 sudo 权限</p>
<p>登录到新服务器。打开 AC Terminal，然后 :</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">ssh root@xxx.xxx.xxx.xxx  <span class="hljs-comment"># xxx.xxx.xxx.xxx替换成新服务器的公网IP</span><br></code></pre></td></tr></table></figure>
<p>创建acs用户 :</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH">adduser acs  <span class="hljs-comment"># 创建用户acs</span><br>usermod -aG sudo acs  <span class="hljs-comment"># 给用户acs分配sudo权限</span><br></code></pre></td></tr></table></figure>
<p>配置免密登录方式</p>
<p>退回AC Terminal，然后配置acs用户的别名和免密登录，可以参考4. ssh——ssh登录</p>
<p>配置新服务器的工作环境</p>
<p>将 AC Terminal 的配置传到新服务器上 :</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">scp .bashrc .vimrc .tmux.conf server_name:  <span class="hljs-comment"># server_name需要换成自己配置的别名</span><br></code></pre></td></tr></table></figure>
<p>安装 tmux 和 docker</p>
<p>登录自己的服务器，然后安装 tmux :</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SH">sudo apt-get update<br>sudo apt-get install tmux<br></code></pre></td></tr></table></figure>
<p>打开 tmux。（养成好习惯，所有工作都在 tmux 里进行，防止意外关闭终端后，工作进度丢失）</p>
<p>然后在 tmux 中根据 docker安装教程 安装 docker 即可</p>
<h3 id="docker教程">docker教程</h3>
<p>将当前用户添加到 <code>docker</code> 用户组</p>
<p>为了避免每次使用 <code>docker</code> 命令都需要加上 <code>sudo</code> 权限，可以将当前用户加入安装中自动创建的 <code>docker</code> 用户组(可以参考<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/linux-postinstall/">官方文档</a>) :</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SH">sudo groupadd docker<br>sudo usermod -aG docker <span class="hljs-variable">$USER</span><br>newgrp docker<br><br><span class="hljs-comment"># Verify that you can run docker commands without sudo</span><br>docker run hello-world<br></code></pre></td></tr></table></figure>
<p><strong>镜像（images）</strong></p>
<ol>
<li>
<p><code>docker pull ubuntu:20.04</code> : 拉取一个镜像</p>
</li>
<li>
<p><code>docker images</code> : 列出本地所有镜像</p>
</li>
<li>
<p><code>docker image rm ubuntu:20.04 或 docker rmi ubuntu:20.04</code> : 删除镜像 ubuntu:20.04</p>
</li>
<li>
<p><code>docker [container] commit CONTAINER IMAGE_NAME:TAG</code> : 创建某个 container 的镜像</p>
</li>
<li>
<p><code>docker save -o ubuntu_20_04.tar ubuntu:20.04</code> : 将镜像 ubuntu:20.04 导出到本地文件 ubuntu_20_04.tar 中</p>
</li>
<li>
<p><code>docker load -i ubuntu_20_04.tar</code> : 将镜像 ubuntu:20.04 从本地文件 ubuntu_20_04.tar 中加载出来<br>
<strong>容器(container)</strong></p>
</li>
<li>
<p><code>docker [container] create -it ubuntu:20.04</code> : 利用镜像 ubuntu:20.04 创建一个容器。</p>
</li>
<li>
<p><code>docker ps -a :</code> 查看本地的所有容器</p>
</li>
<li>
<p><code>docker [container] start CONTAINER</code> : 启动容器</p>
</li>
<li>
<p><code>docker [container] stop CONTAINER</code> : 停止容器</p>
</li>
<li>
<p><code>docker [container] restart CONTAINER</code> : 重启容器</p>
</li>
<li>
<p><code>docker [contaienr] run -itd ubuntu:20.04</code> : 创建并启动一个容器</p>
</li>
<li>
<p><code>docker [container] attach CONTAINER</code> : 进入容器</p>
</li>
<li>
<p>先按 <code>Ctrl-p</code> ，再按 <code>Ctrl-q</code> 可以挂起容器</p>
</li>
<li>
<p><code>docker [container] exec CONTAINER COMMAND</code> : 在容器中执行命令</p>
</li>
<li>
<p><code>docker [container] rm CONTAINER</code> : 删除容器</p>
</li>
<li>
<p><code>docker container prune</code> : 删除所有已停止的容器</p>
</li>
<li>
<p><code>docker export -o xxx.tar CONTAINER</code> : 将容器 CONTAINER 导出到本地文件 xxx.tar 中</p>
</li>
<li>
<p><code>docker import xxx.tar image_name:tag</code> : 将本地文件 xxx.tar 导入成镜像，并将镜像命名为 image_name:tag</p>
</li>
<li>
<p><code>docker export/import</code> 与 <code>docker save/load</code>的区别 :</p>
<ol>
<li><code>export/import</code> 会丢弃历史记录和元数据信息，仅保存容器当时的快照状态</li>
<li><code>save/load</code> 会保存完整记录，体积更大</li>
</ol>
</li>
<li>
<p><code>docker top CONTAINER</code> : 查看某个容器内的所有进程</p>
</li>
<li>
<p><code>docker stats</code> : 查看所有容器的统计信息，包括CPU、内存、存储、网络等信息</p>
</li>
<li>
<p><code>docker cp xxx CONTAINER:xxx</code> 或 <code>docker cp CONTAINER:xxx xxx</code> : 在本地和容器间复制文件</p>
</li>
<li>
<p><code>docker rename CONTAINER1 CONTAINER2</code> : 重命名容器</p>
</li>
<li>
<p><code>docker update CONTAINER --memory 500MB</code> : 修改容器限制</p>
</li>
</ol>
<blockquote>
<p>更多可以查阅官方文档，在左上角搜索指令即可</p>
</blockquote>
<p>实战</p>
<p>进入 AC Terminal ，然后</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs SH"><br><span class="hljs-comment"># 将镜像上传到自己租的云端服务器</span><br>scp /var/lib/acwing/docker/images/docker_lesson_1_0.tar server_name:<br><span class="hljs-comment"># 登录自己的云端服务器</span><br>ssh server_name<br><br><span class="hljs-comment"># 将镜像加载到本地</span><br>docker load -i docker_lesson_1_0.tar<br><span class="hljs-comment"># 创建并运行docker_lesson:1.0镜像</span><br><span class="hljs-comment"># 将docker镜像的22号端口映射到服务器的20000号端口</span><br>docker run -p 20000:22 --name my_docker_server -itd docker_lesson:1.0<br><br><span class="hljs-comment"># 进入创建的docker容器</span><br>docker attach my_docker_server<br><span class="hljs-comment"># 设置root密码</span><br>passwd<br></code></pre></td></tr></table></figure>
<p>去云平台控制台中修改安全组配置，放行端口 20000</p>
<p>返回 AC Terminal，即可通过 ssh 登录自己的 docker 容器：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SH">ssh root@xxx.xxx.xxx.xxx -p 20000  <span class="hljs-comment"># 将xxx.xxx.xxx.xxx替换成自己租的服务器的IP地址</span><br></code></pre></td></tr></table></figure>
<p>然后，可以仿照上节课内容，创建工作账户 acs</p>
<p>最后，可以参考 4. ssh——ssh登录 配置 docker 容器的别名和免密登录</p>
<p>小Tips</p>
<p>如果 apt-get 下载软件速度较慢，可以参考 <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/">清华大学开源软件镜像站</a> 中的内容，修改软件源。</p>
<h3 id="作业-8">作业</h3>
<ol start="0">
<li>进入 homework_0 文件夹，然后：</li>
</ol>
<p>租一台云服务器<br>
配置服务器别名及免密登录<br>
将服务器别名写在当前目录下的 server_name.txt 文件中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cd homework/lesson_8/<br>echo tenserver &gt; server_name.txt  # server1要替换成自己起的别名<br></code></pre></td></tr></table></figure>
<ol>
<li>进入 homework_1 文件夹，然后：</li>
</ol>
<p>在租好的云服务器中安装 docker<br>
2. 进入 homework_2 文件夹，然后：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">tmux  # 好习惯，进入tmux<br><br>sudo apt-get update<br><br>sudo apt-get install \<br>    apt-transport-https \<br>    ca-certificates \<br>    curl \<br>    gnupg \<br>    lsb-release<br><br>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg<br><br>echo \<br>&quot;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \<br>$(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null<br><br>sudo apt-get update<br><br>sudo apt-get install docker-ce docker-ce-cli containerd.io<br><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>将 AC Terminal 中的 /var/lib/acwing/docker/images/docker_lesson_1_0.tar 镜像上传到租好的服务器中<br>
登录到租好的服务器<br>
将上传的镜像提取出来<br>
创建该镜像的容器，设置端口映射：20000:22<br>
去云平台控制台中修改安全组配置，放行端口 20000<br>
进入该容器，创建新账户 acs<br>
返回 AC Terminal。配置容器中 acs 账户的别名及免密登录<br>
将别名写在当前目录下的 server_name.txt 文件中</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">scp /var/lib/acwing/docker/images/docker_lesson_1_0.tar server_name:  # 将镜像上传到自己租的云端服务器<br>ssh server_name  # 登录自己的云端服务器<br><br>docker load -i docker_lesson_1_0.tar  # 将镜像加载到本地<br>docker run -p 20000:22 --name my_docker_server -itd docker_lesson:1.0  # 创建并运行docker_lesson:1.0镜像<br><br># 去云平台放开20000端口<br><br>docker attach my_docker_server  # 进入创建的docker容器<br>adduser acs<br><br>Ctrl-p<br>Ctrl-q  # 挂起容器<br></code></pre></td></tr></table></figure>
<p>退回AC Terminal，配置别名和免密登录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cd homework/lesson_8/homework_2<br>echo server1_docker &gt; server_name.txt  # 将server1_docker换成自己起的别名<br></code></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:2039222749@qq.com">Komorebi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wenxilzy.github.io/2022/05/06/Linux%E5%AD%A6%E4%B9%A0/">https://wenxilzy.github.io/2022/05/06/Linux%E5%AD%A6%E4%B9%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wenxilzy.github.io" target="_blank">Komorebi</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.acwing.com/media/article/image/2022/05/16/99310_ddc885a5d4-00117.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://fastly.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/06/Web%E5%AD%A6%E4%B9%A0/"><img class="prev-cover" src="https://cdn.acwing.com/media/article/image/2022/05/16/99310_f01416b0d4-8.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Web学习</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/06/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"><img class="next-cover" src="https://cdn.acwing.com/media/article/image/2022/05/16/99310_ed8cfc7ed4-7.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">树状数组</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.acwing.com/media/article/image/2022/06/14/99310_54e0b37ceb-touxiang2.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Komorebi</div><div class="author-info__description">自信人生二百年,会当水击三千里</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wenxilzy" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2039222749@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">个人QQ：2039222749 欢迎大家交流</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="toc-number">1.</span> <span class="toc-text">常用文件管理命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.</span> <span class="toc-text">linux文件系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0%E8%B7%AF%E5%BE%84%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">描述路径的方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">1.3.</span> <span class="toc-text">文件常用指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AC-Terminaal%E7%9A%84lab%E6%8C%87%E5%8D%97"><span class="toc-number">1.4.</span> <span class="toc-text">AC-Terminaal的lab指南</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A"><span class="toc-number">1.5.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tmux%E5%92%8Cvim"><span class="toc-number">2.</span> <span class="toc-text">tmux和vim</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tmux%E6%95%99%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">tmux教程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vim%E6%95%99%E7%A8%8B"><span class="toc-number">2.2.</span> <span class="toc-text">vim教程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-2"><span class="toc-number">2.3.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell%E8%AF%AD%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">shell语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%AE%BA"><span class="toc-number">3.1.</span> <span class="toc-text">概论</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">3.2.</span> <span class="toc-text">注释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">3.3.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%8F%98%E9%87%8F"><span class="toc-number">3.4.</span> <span class="toc-text">默认变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#expr%E5%91%BD%E4%BB%A4"><span class="toc-number">3.5.</span> <span class="toc-text">expr命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#read%E5%91%BD%E4%BB%A4"><span class="toc-number">3.6.</span> <span class="toc-text">read命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#echo%E5%91%BD%E4%BB%A4"><span class="toc-number">3.7.</span> <span class="toc-text">echo命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#printf%E5%91%BD%E4%BB%A4"><span class="toc-number">3.8.</span> <span class="toc-text">printf命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#test%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%88%A4%E6%96%AD%E7%AC%A6%E5%8F%B7"><span class="toc-number">3.9.</span> <span class="toc-text">test命令与判断符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.10.</span> <span class="toc-text">判断语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.11.</span> <span class="toc-text">循环语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">3.12.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exit%E5%91%BD%E4%BB%A4"><span class="toc-number">3.13.</span> <span class="toc-text">exit命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">3.14.</span> <span class="toc-text">文件重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E5%A4%96%E9%83%A8%E8%84%9A%E6%9C%AC"><span class="toc-number">3.15.</span> <span class="toc-text">引入外部脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-3"><span class="toc-number">3.16.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ssh"><span class="toc-number">4.</span> <span class="toc-text">ssh</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh%E7%99%BB%E9%99%86"><span class="toc-number">4.1.</span> <span class="toc-text">ssh登陆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scp-%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="toc-number">4.2.</span> <span class="toc-text">scp 传文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-4"><span class="toc-number">4.3.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#git"><span class="toc-number">5.</span> <span class="toc-text">git</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">5.1.</span> <span class="toc-text">git基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">5.2.</span> <span class="toc-text">git常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-%E5%8D%95%E5%88%86%E6%94%AF%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">5.3.</span> <span class="toc-text">git 单分支基本指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-%E5%8D%95%E5%88%86%E6%94%AF%E7%89%88%E6%9C%AC%E5%88%87%E6%8D%A2%E6%8C%87%E4%BB%A4"><span class="toc-number">5.4.</span> <span class="toc-text">git 单分支版本切换指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-%E5%8D%95%E5%88%86%E6%94%AF%E4%B8%8E%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E4%BA%A4%E4%BA%92%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-number">5.5.</span> <span class="toc-text">git 单分支与远程仓库交互的指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-%E5%A4%9A%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E6%8C%87%E4%BB%A4"><span class="toc-number">5.6.</span> <span class="toc-text">git 多分支管理指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-%E5%A4%9A%E5%88%86%E6%94%AF%E4%B8%8E%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E4%BA%A4%E4%BA%92%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-number">5.7.</span> <span class="toc-text">git 多分支与远程仓库交互的指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-stash%E6%9A%82%E5%AD%98"><span class="toc-number">5.8.</span> <span class="toc-text">git stash暂存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-5"><span class="toc-number">5.9.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#thrift"><span class="toc-number">6.</span> <span class="toc-text">thrift</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E9%98%85thrift%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="toc-number">6.1.</span> <span class="toc-text">查阅thrift官方文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8-thrift-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%8C%B9%E9%85%8D%E7%B3%BB%E7%BB%9F-%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.2.</span> <span class="toc-text">用 thrift 实现一个基本的匹配系统 接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-%E6%B8%B8%E6%88%8F%E5%BA%94%E7%94%A8%E7%AB%AF-%E4%B8%8E-%E5%8C%B9%E9%85%8D%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%9A%84%E4%BA%A4%E4%BA%92"><span class="toc-number">6.3.</span> <span class="toc-text">实现 游戏应用端 与 匹配系统服务器 的交互</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">6.3.1.</span> <span class="toc-text">匹配系统服务器的客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E5%BA%94%E7%94%A8%E7%AB%AF%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">6.3.2.</span> <span class="toc-text">游戏应用端的客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E5%8C%B9%E9%85%8D%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%87%8C%E7%BB%99-%E5%8C%B9%E9%85%8D%E7%B3%BB%E7%BB%9F-%E5%BC%80%E4%B8%80%E4%B8%AA-%E7%BA%BF%E7%A8%8B"><span class="toc-number">6.3.3.</span> <span class="toc-text">在匹配服务器里给 匹配系统 开一个 线程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%E5%99%A8-%E4%B8%8E-%E5%8C%B9%E9%85%8D%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%9A%84%E4%BA%A4%E4%BA%92"><span class="toc-number">6.3.4.</span> <span class="toc-text">数据存储服务器 与 匹配系统服务器 的交互</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-6"><span class="toc-number">6.4.</span> <span class="toc-text">作业</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E9%81%93%E3%80%81%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%B8%8E%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">6.5.</span> <span class="toc-text">管道、环境变量与常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E9%81%93"><span class="toc-number">6.5.1.</span> <span class="toc-text">管道</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">6.5.2.</span> <span class="toc-text">环境变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">6.6.</span> <span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%8A%B6%E5%86%B5"><span class="toc-number">6.6.1.</span> <span class="toc-text">系统状况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90"><span class="toc-number">6.6.2.</span> <span class="toc-text">文件权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%A3%80%E7%B4%A2"><span class="toc-number">6.6.3.</span> <span class="toc-text">文件检索</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">6.6.4.</span> <span class="toc-text">查看文件内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%9B%B8%E5%85%B3"><span class="toc-number">6.6.5.</span> <span class="toc-text">用户相关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"><span class="toc-number">6.6.6.</span> <span class="toc-text">安装软件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-7"><span class="toc-number">6.7.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%9F%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%8A%E5%AE%89%E8%A3%85docker"><span class="toc-number">7.</span> <span class="toc-text">租云服务器及安装docker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E6%95%99%E7%A8%8B"><span class="toc-number">7.1.</span> <span class="toc-text">docker教程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-8"><span class="toc-number">7.2.</span> <span class="toc-text">作业</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/06/14/2022%E6%9A%91%E5%81%87%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/" title="2022暑假每日一题"><img src="https://cdn.acwing.com/media/article/image/2022/05/16/99310_f01416b0d4-8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022暑假每日一题"/></a><div class="content"><a class="title" href="/2022/06/14/2022%E6%9A%91%E5%81%87%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/" title="2022暑假每日一题">2022暑假每日一题</a><time datetime="2022-06-14T12:01:25.000Z" title="发表于 2022-06-14 20:01:25">2022-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/10/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80%E7%AC%AC%E4%BA%94%E7%AB%A0%E8%AF%BE%E5%90%8E%E4%B9%A0%E9%A2%98/" title="软件技术基础第五章课后习题"><img src="https://cdn.acwing.com/media/article/image/2022/05/16/99310_f01416b0d4-8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="软件技术基础第五章课后习题"/></a><div class="content"><a class="title" href="/2022/06/10/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80%E7%AC%AC%E4%BA%94%E7%AB%A0%E8%AF%BE%E5%90%8E%E4%B9%A0%E9%A2%98/" title="软件技术基础第五章课后习题">软件技术基础第五章课后习题</a><time datetime="2022-06-10T12:00:51.000Z" title="发表于 2022-06-10 20:00:51">2022-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/10/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80%E7%AC%AC%E5%9B%9B%E7%AB%A0%E8%AF%BE%E5%90%8E%E4%B9%A0%E9%A2%98/" title="软件技术基础第四章课后习题"><img src="https://cdn.acwing.com/media/article/image/2022/05/16/99310_e759d740d4-5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="软件技术基础第四章课后习题"/></a><div class="content"><a class="title" href="/2022/06/10/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80%E7%AC%AC%E5%9B%9B%E7%AB%A0%E8%AF%BE%E5%90%8E%E4%B9%A0%E9%A2%98/" title="软件技术基础第四章课后习题">软件技术基础第四章课后习题</a><time datetime="2022-06-10T12:00:40.000Z" title="发表于 2022-06-10 20:00:40">2022-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/10/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80%E7%AC%AC%E4%B8%89%E7%AB%A0%E8%AF%BE%E5%90%8E%E4%B9%A0%E9%A2%98/" title="软件技术基础第三章课后习题"><img src="https://cdn.acwing.com/media/article/image/2022/05/16/99310_dfda541bd4-2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="软件技术基础第三章课后习题"/></a><div class="content"><a class="title" href="/2022/06/10/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80%E7%AC%AC%E4%B8%89%E7%AB%A0%E8%AF%BE%E5%90%8E%E4%B9%A0%E9%A2%98/" title="软件技术基础第三章课后习题">软件技术基础第三章课后习题</a><time datetime="2022-06-10T11:59:01.000Z" title="发表于 2022-06-10 19:59:01">2022-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/08/%E6%AD%A6%E5%BF%A0%E7%A5%A5%E8%80%81%E5%B8%88%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%E7%AC%AC368-380%E9%A2%98/" title="武忠祥老师每日一题第368-380题"><img src="https://cdn.acwing.com/media/article/image/2022/05/16/99310_f01416b0d4-8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="武忠祥老师每日一题第368-380题"/></a><div class="content"><a class="title" href="/2022/06/08/%E6%AD%A6%E5%BF%A0%E7%A5%A5%E8%80%81%E5%B8%88%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%E7%AC%AC368-380%E9%A2%98/" title="武忠祥老师每日一题第368-380题">武忠祥老师每日一题第368-380题</a><time datetime="2022-06-08T09:09:23.000Z" title="发表于 2022-06-08 17:09:23">2022-06-08</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.acwing.com/media/article/image/2022/04/29/99310_a4e287c0c7-footer.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Komorebi</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://fastly.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://fastly.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://fastly.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'wX2XPR5wOL6aJ8jBbOdg7trP-gzGzoHsz',
      appKey: 'Y51G9WhyCNKKAk8bcqX5459G',
      avatar: 'https://cdn.acwing.com/media/article/image/2022/04/29/99310_7f50d0aec7-avatar2.png',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://fastly.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://wenxilzy.github.io/2022/05/06/Linux%E5%AD%A6%E4%B9%A0/'
    this.page.identifier = '2022/05/06/Linux学习/'
    this.page.title = 'Linux学习'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script src="https://fastly.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://fastly.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/172c8bea.js","daovoice")
</script><script>var isChatBtn = true
daovoice('init', {
  app_id: '172c8bea',},{
  launcher: { 
     disableLauncherIcon: isChatBtn // 悬浮 ICON 是否显示
  },
});
daovoice('update');

if (isChatBtn) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      daovoice('show')
    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: true // 悬浮 ICON 是否显示
        },
      });
    }
    function chatBtnShow () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: false // 悬浮 ICON 是否显示
        },
      });
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>